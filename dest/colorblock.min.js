!function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[r]={exports:{}};e[r][0].call(u.exports,function(t){var n=e[r][1][t];return o(n?n:t)},u,u.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){this.options=t||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||0,this._map=t.map,this._lastDrawTime=null,this._enableEdgeMove=!1,this.show()}function l(){}function c(t,e,n){var i=!0;if(t){var o=0,a=t.length,r=e[0],s=e[1],l=e[2];switch(e.length){case 0:for(;a>o;o+=2)i=t[o].call(t[o+1]||n)!==!1&&i;break;case 1:for(;a>o;o+=2)i=t[o].call(t[o+1]||n,r)!==!1&&i;break;case 2:for(;a>o;o+=2)i=t[o].call(t[o+1]||n,r,s)!==!1&&i;break;case 3:for(;a>o;o+=2)i=t[o].call(t[o+1]||n,r,s,l)!==!1&&i;break;default:for(;a>o;o+=2)i=t[o].apply(t[o+1]||n,e)!==!1&&i}}return i}function u(t){return"[object Function]"===Object.prototype.toString.call(t)}function g(t,e){this.drawingManager=t,e=this.drawingToolOptions=e||{},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMap.Size(10,10),this.defaultDrawingModes=[BMAP_DRAWING_MARKER,BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE],e.drawingModes?this.drawingModes=e.drawingModes:this.drawingModes=this.defaultDrawingModes,e.anchor&&this.setAnchor(e.anchor),e.offset&&this.setOffset(e.offset)}var p=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},d=d||{guid:"$BAIDU$"};!function(){window[d.guid]={},d.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},d.lang=d.lang||{},d.lang.guid=function(){return"TANGRAM__"+(window[d.guid]._counter++).toString(36)},window[d.guid]._counter=window[d.guid]._counter||1,window[d.guid]._instances=window[d.guid]._instances||{},d.lang.Class=function(t){this.guid=t||d.lang.guid(),window[d.guid]._instances[this.guid]=this},window[d.guid]._instances=window[d.guid]._instances||{},d.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},d.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},d.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},d.lang.Class.prototype.dispose=function(){delete window[d.guid]._instances[this.guid];for(var t in this)d.lang.isFunction(this[t])||delete this[t];this.disposed=!0},d.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},d.lang.Class.prototype.addEventListener=function(t,e,n){if(d.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var i,o=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;e.hashCode=n,i=n}0!=t.indexOf("on")&&(t="on"+t),"object"!=h(o[t])&&(o[t]={}),i=i||d.lang.guid(),e.hashCode=i,o[t][i]=e}},d.lang.Class.prototype.removeEventListener=function(t,e){if(d.lang.isFunction(e))e=e.hashCode;else if(!d.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},d.lang.Class.prototype.dispatchEvent=function(t,e){d.lang.isString(t)&&(t=new d.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var n in e)t[n]=e[n];var n,i=this.__listeners,o=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),d.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==h(i[o]))for(n in i[o])i[o][n].apply(this,arguments);return t.returnValue},d.lang.inherits=function(t,e,n){var i,o,a=t.prototype,r=new Function;r.prototype=e.prototype,o=t.prototype=new r;for(i in a)o[i]=a[i];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof n&&(o._className=n)},d.dom=d.dom||{},d._g=d.dom._g=function(t){return d.lang.isString(t)?document.getElementById(t):t},d.g=d.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},d.insertHTML=d.dom.insertHTML=function(t,e,n){t=d.dom.g(t);var i,o;return t.insertAdjacentHTML?t.insertAdjacentHTML(e,n):(i=t.ownerDocument.createRange(),e=e.toUpperCase(),"AFTERBEGIN"==e||"BEFOREEND"==e?(i.selectNodeContents(t),i.collapse("AFTERBEGIN"==e)):(o="BEFOREBEGIN"==e,i[o?"setStartBefore":"setEndAfter"](t),i.collapse(o)),i.insertNode(i.createContextualFragment(n))),t},d.ac=d.dom.addClass=function(t,e){t=d.dom.g(t);for(var n=e.split(/\s+/),i=t.className,o=" "+i+" ",a=0,r=n.length;r>a;a++)o.indexOf(" "+n[a]+" ")<0&&(i+=(i?" ":"")+n[a]);return t.className=i,t},d.event=d.event||{},d.event._listeners=d.event._listeners||[],d.on=d.event.on=function(t,e,n){e=e.replace(/^on/i,""),t=d._g(t);var i,o=function(e){n.call(t,e)},a=d.event._listeners,r=d.event._eventFilter,s=e;return e=e.toLowerCase(),r&&r[e]&&(i=r[e](t,e,o),s=i.type,o=i.listener),t.addEventListener?t.addEventListener(s,o,!1):t.attachEvent&&t.attachEvent("on"+s,o),a[a.length]=[t,e,n,o,s],t},d.un=d.event.un=function(t,e,n){t=d._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var i,o,a,r=d.event._listeners,s=r.length,l=!n;s--;)i=r[s],i[1]!==e||i[0]!==t||!l&&i[2]!==n||(o=i[4],a=i[3],t.removeEventListener?t.removeEventListener(o,a,!1):t.detachEvent&&t.detachEvent("on"+o,a),r.splice(s,1));return t},d.getEvent=d.event.getEvent=function(t){return window.event||t},d.getTarget=d.event.getTarget=function(t){var t=d.getEvent(t);return t.target||t.srcElement},d.preventDefault=d.event.preventDefault=function(t){var t=d.getEvent(t);t.preventDefault?t.preventDefault():t.returnValue=!1},d.stopBubble=d.event.stopBubble=function(t){t=d.getEvent(t),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},d.browser=d.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(d.browser.ie=d.ie=document.documentMode||+RegExp.$1)}(),s.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,s.prototype.addEventListener=d.lang.Class.prototype.addEventListener,s.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,window.BMap&&(s.prototype=new BMap.Overlay,s.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),t.getPanes()[this.paneName].appendChild(e);var n=this;return t.addEventListener("resize",function(){n.adjustSize(),n._draw()}),this._bind(),this.canvas},s.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,n=1;n="webgl"==this.context?1:function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}(e.getContext("2d")),e.width=t.width*n,e.height=t.height*n,e.style.width=t.width+"px",e.style.height=t.height+"px"},s.prototype.draw=function(){(!this._lastDrawTime||new Date-this._lastDrawTime>10)&&this._draw(),this._lastDrawTime=new Date},s.prototype._draw=function(){var t=this._map,e=t.getSize(),n=t.getCenter();if(n){var i=t.pointToOverlayPixel(n);this.canvas.style.left=i.x-e.width/2+"px",this.canvas.style.top=i.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},s.prototype.getContainer=function(){return this.canvas},s.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},s.prototype.hide=function(){this.canvas.style.display="none"},s.prototype.setZIndex=function(t){this.canvas.style.zIndex=t},s.prototype.getZIndex=function(){return this.zIndex},s.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},s.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},s.prototype._bind=function(){for(var t=this,e=(this._map,this.getContainer()),n=null,i=null,o=function(t){return{x:t.clientX,y:t.clientY}},a=function(e){var a=e.type;e=d.getEvent(e);var r=t.getDrawPoint(e),s=function(n){e.point=r,t.dispatchEvent(e)};"mousedown"==a&&(n=o(e));var l=o(e);"click"==a?Math.abs(l.x-n.x)<5&&Math.abs(l.y-n.y)<5&&(i&&Math.abs(l.x-i.x)<5&&Math.abs(l.y-i.y)<5?i=null:(s("click"),i=o(e))):s(a)},r=["click","mousedown","mousemove","mouseup","dblclick"],s=r.length;s--;)d.on(e,r[s],a);d.on(e,"mousemove",function(e){t._enableEdgeMove&&t.mousemoveAction(e)})},s.prototype.mousemoveAction=function(t){function e(t){var e=t.clientX,n=t.clientY;return t.changedTouches&&(e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY),new BMap.Pixel(e,n)}var n=this._map,i=this,o=n.pointToPixel(this.getDrawPoint(t)),a=e(t),r=a.x-o.x,s=a.y-o.y;o=new BMap.Pixel(a.x-r,a.y-s),this._draggingMovePixel=o;n.pixelToPoint(o);this._panByX=this._panByY=0,o.x<=20||o.x>=n.width-20||o.y<=50||o.y>=n.height-10?(o.x<=20?this._panByX=8:o.x>=n.width-20&&(this._panByX=-8),o.y<=50?this._panByY=8:o.y>=n.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){n.panBy(i._panByX,i._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},s.prototype.getDrawPoint=function(t){var e=this._map,n=d.getTarget(t),i=t.offsetX||t.layerX||0,o=t.offsetY||t.layerY||0;for(1!=n.nodeType&&(n=n.parentNode);n&&n!=e.getContainer();)0==n.clientWidth&&0==n.clientHeight&&n.offsetParent&&"TD"==n.offsetParent.nodeName||(i+=n.offsetLeft||0,o+=n.offsetTop||0),n=n.offsetParent;var a=new BMap.Pixel(i,o),r=e.pixelToPoint(a);return r});var f=/\s+/;l.prototype.on=function(t,e,n){var i,o,a;if(!e)return this;for(i=this.__events||(this.__events={}),t=t.split(f);o=t.shift();)a=i[o]||(i[o]=[]),a.push(e,n);return this},l.prototype.once=function(t,e,n){var i=this,o=function a(){i.off(t,a),e.apply(n||i,arguments)};return this.on(t,o,n)},l.prototype.off=function(t,e,n){var i,o,a,r;if(!(i=this.__events))return this;if(!(t||e||n))return delete this.__events,this;for(t=t?t.split(f):y(i);o=t.shift();)if(a=i[o])if(e||n)for(r=a.length-2;r>=0;r-=2)e&&a[r]!==e||n&&a[r+1]!==n||a.splice(r,2);else delete i[o];return this},l.prototype.trigger=function(t){var e,n,i,o,a,r,s=[],l=!0;if(!(e=this.__events))return this;for(t=t.split(f),a=1,r=arguments.length;r>a;a++)s[a-1]=arguments[a];for(;n=t.shift();)(i=e.all)&&(i=i.slice()),(o=e[n])&&(o=o.slice()),"all"!==n&&(l=c(o,s,this)&&l),l=c(i,[n].concat(s),this)&&l;return l},l.prototype.emit=l.prototype.trigger;var y=Object.keys;y||(y=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}),l.mixTo=function(t){function e(e){t[e]=function(){return n[e].apply(o,Array.prototype.slice.call(arguments)),this}}var n=l.prototype;if(u(t)){for(var i in n)n.hasOwnProperty(i)&&(t.prototype[i]=n[i]);Object.keys(n).forEach(function(e){t.prototype[e]=n[e]})}else{var o=new l;for(var i in n)n.hasOwnProperty(i)&&e(i)}};var v=function(){function t(){r(this,t),l.mixTo(this)}return p(t,[{key:"bindEvent",value:function(t){this.event=t}}]),t}();v.prototype.listen=v.prototype.on;var _=new l,w=gpcas.geometry.PolyDefault,m=function(){function t(e,n){r(this,t),this.blockDatas=[].concat(e),this.currPolygon=[].concat(n),this.interPoints=[],this.defPolygon=[],this._initDefPolygon(e,n)}return p(t,[{key:"getPolygon",value:function(){return this.defPolygon}},{key:"_initDefPolygon",value:function(t,e){return t.length&&e.length?void this._diffAllPolygon(t,e):t.length?void this.defPolygon.push(t):void(e.length&&this.defPolygon.push(e))}},{key:"_diffAllPolygon",value:function(t,e){var n=this,i=[e],o=void 0,a=void 0;t.map(function(t,e){t.polygons.map(function(t,e){var r=[];i.map(function(e,i){o=n._createPoly(n._getTempPolygon(t)),a=n._createPoly(n._getTempPolygon(e));var s=n._diffPolygon(o,a);r=r.concat(s)}),i=r})}),n.defPolygon=n.defPolygon.concat(i)}},{key:"_diffPolygon",value:function(t,e){var n=e.difference(t),i=this._getPolygons(n);return i}},{key:"_getPolygons",value:function(t){for(var e=this,n=t.getNumInnerPoly(),i=[],o=0;n>o;o++){var a=t.getInnerPoly(o),r=e._getPolygonVertices(a),s=r.map(function(t,e){return{lat:t[0]/1e6,lng:t[1]/1e6}});s.push(s[0]),i.push(s)}return i}},{key:"_getTempPolygon",value:function(t){var e=[];return t.map(function(t,n){e.push(Object.assign(t,{x:1e6*t.lat,y:1e6*t.lng}))}),e}},{key:"_createPoly",value:function(t){var e=new w;return t.map(function(t,n){e.addPoint(new P(t.x,t.y))}),e}},{key:"_getPolygonVertices",value:function(t){var e,n=[],i=t.getNumPoints();for(e=0;i>e;e++)n.push([t.getX(e),t.getY(e)]);return n}}]),t}(),P=function L(t,e){r(this,L),this.x=t,this.y=e},b=function(t){function e(){r(this,e);var t=o(this,Object.getPrototypeOf(e).call(this));return t.data={drawingType:"normal",_isopen:!1,cacheData:[],blockData:[],unionPolygon:[],interPoints:[]},t.bindEvent(_),t.onReady(),t}return a(e,t),p(e,[{key:"setDrawingType",value:function(t){this.data.drawingType=t}},{key:"getDrawingType",value:function(){return this.data.drawingType}},{key:"setIsOpen",value:function(t){this.data._isopen=t}},{key:"getIsOpen",value:function(){return this.data._isopen}},{key:"setCacheData",value:function(t){this.data.cacheData=this._formateData(t)}},{key:"getCacheData",value:function(){return this.data.cacheData}},{key:"getUniqId",value:function(t){return(t||"")+(new Date).getTime().toString(36)}},{key:"deletePolygonById",value:function(t){var e=this.getBlockData(),n=!1,i=e.filter(function(e){return e.id===t?(hadremove=!0,!1):!0},this);return this.data.blockData=i,n}},{key:"setBlockData",value:function(t){t.data=this._formateData(t.data);var e=this._getPolygonData(t),n={};n.drawingType=this.getDrawingType(),n.id=this.getUniqId("block"),n.polygons=e,d.extend(n,t),this.data.blockData.push(n)}},{key:"getBlockData",value:function(){return this.data.blockData}},{key:"_formateData",value:function(t){var e=this.getDrawingType();return e===BMAP_DRAWING_POLYGON&&t.length>0&&(t=t.concat(t[0])),t}},{key:"setLastPolygon",value:function(t){this.data.lastPolygon=t}},{key:"getLastPolygon",value:function(){return this.data.lastPolygon}},{key:"setInterPoints",value:function(t){this.data.interPoints=this.data.interPoints.concat(t)}},{key:"getInterPoints",value:function(){return this.data.interPoints}},{key:"_getPolygonData",value:function(t){var e=this.getBlockData(),n=new m(e,t.data),i=n.getPolygon();return i}},{key:"onReady",value:function(){var t=this,e="ready";this.event.on("setDrawType",function(n){t.setDrawingType(n),t.trigger(e,"setDrawType",t.getDrawingType())}),this.event.on("setDrawStatus",function(n){t.setIsOpen(n),t.trigger(e,"setDrawStatus",t.getIsOpen())}),this.event.on("drawingCache",function(n){t.setCacheData(n),t.trigger(e,"drawingCache",t.getCacheData())}),this.event.on("drawComplete",function(n){t.setBlockData(n),t.setCacheData([]),t.trigger(e,"drawComplete",t.getBlockData())}),this.event.on("delete_polygon_byid",function(n){var i=t.deletePolygonById(n);t.trigger(e,"deletePolygonById",i,t.getBlockData())})}}]),e}(v),k=new b,D=function(){function t(e,n){r(this,t);var i=this;i.map=e,i.config=n,i.canvasLayer=new s({map:e,update:function(){i._updateMap.apply(i)}});var o=i.ctx=i.canvasLayer.canvas.getContext("2d");o&&(l.mixTo(i),i._listenStore())}return p(t,[{key:"_listenStore",value:function(){var t=this;k.listen("ready",function(e,n){"drawingCache"===e?t._updateMap():"drawComplete"===e&&t._updateMap()})}},{key:"_updateMap",value:function(){this.canvasLayer&&this._drawCtx()}},{key:"_drawCtx",value:function(){this._clearRect(),this._drawCacheData(),this._drawPolygonData(),this._drawInterPoints()}},{key:"_clearRect",value:function(){var t=this.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_drawCacheData",value:function(){var t=this,e=k.getCacheData(),n=k.getBlockData(),i=k.getDrawingType(),o=void 0;0!=e.length&&e&&(o=e.map(function(e,n){return t._lnglatToPix(e)}),this._drawDispatcher(i,o,n.length))}},{key:"_drawBlockData",value:function(){var t=this,e=k.getBlockData();0!==e.length&&e&&e.map(function(e,n){var i=e.data.map(function(e,n){return t._lnglatToPix(e)});t._drawDispatcher(e.drawingType,i)})}},{key:"_drawPolygonData",value:function(){var t=this,e=k.getBlockData();0!==e.length&&e&&(console.log("polygon Data:",e),e.map(function(e,n){e.polygons.map(function(i){var o=i.map(function(e){return t._lnglatToPix(e)});t._drawDispatcher(e.drawingType,o,n)})}))}},{key:"_drawInterPoints",value:function(){var t=this,e=k.getInterPoints();if(0!==e.length){var n=e.map(function(e){return t._lnglatToPix(e)});t._drawArcPoints(n)}}},{key:"_lnglatToPix",value:function(t){var e=this.map,n=e.pointToPixel(t);return n}},{key:"_drawDispatcher",value:function(t,e,n){var i=this;switch(t){case"rectangle":i.drawPolygon(e,i._drawStyle(n));break;case"polygon":i.drawPolygon(e,i._drawStyle(n))}}},{key:"_drawStyle",value:function(t){var e=this,n=e.config.polygonOptions,i=n.fillColor,o=n.strokeColor,a=n.strokeWeight;return{fillColor:"string"==typeof i?i:i[t%i.length],strokeColor:"string"==typeof o?o:o[t%o.length],strokeWeight:a}}},{key:"drawRectangle",value:function(t,e){var n=this,i=(n.map,n.ctx),o=t[0],a=t[2],r=a.x-o.x,s=a.y-o.y;i.beginPath(),n.setPixelRatio(function(){i.rect(o.x,o.y,r,s),i.fillStyle=e.fillColor,i.fill(),i.strokeStyle=e.strokeColor,i.lineWidth=e.strokeWeight,i.stroke(),i.closePath()})}},{key:"drawPolygon",value:function(t,e){var n=(arguments.length<=2||void 0===arguments[2]?!0:arguments[2],this),i=(this.map,n.ctx);i.beginPath(),n.setPixelRatio(function(){t.map(function(t,e){0===e?i.moveTo(t.x,t.y):i.lineTo(t.x,t.y)}),i.fillStyle=e.fillColor,i.fill(),i.strokeStyle=e.strokeColor,i.lineWidth=e.strokeWeight,i.stroke(),i.closePath()})}},{key:"drawPolyline",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];this.drawPolygon(t,e,n)}},{key:"getPixelRatio",value:function(){var t=this.ctx,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}},{key:"setPixelRatio",value:function(t){var e=this.ctx,n=this.getPixelRatio();e.save(),e.scale(n,n),t&&t(),e.restore()}},{key:"_drawArcPoints",value:function(t){this._storkArc(t),this._fillArc(t)}},{key:"_storkArc",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?3:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"#ffff00":arguments[2],i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],o=this.ctx;o.strokeStyle=n,o.lineWidth=i,this.setPixelRatio(function(){t.map(function(t){o.beginPath(),o.arc(t.x,t.y,e,0,2*Math.PI),o.closePath(),o.stroke()})})}},{key:"_fillArc",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?3:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"#ffffff":arguments[2],i=this.ctx;i.fillStyle=n,this.setPixelRatio(function(){t.map(function(t){i.beginPath(),i.arc(t.x,t.y,e,0,2*Math.PI),i.closePath(),i.fill()})})}}]),t}(),M={strokeColor:"red",fillColor:"rgba(255,0,0,0.5)",strokeWeight:3},x=function(){function t(e){r(this,t),this.config={anchor:BMAP_ANCHOR_TOP_RIGHT,offset:new BMap.Size(5,5),polygonOptions:M,polylineOptions:M,rectangleOptions:M,enableDrawingTool:!0,enableCalculate:!1,controlButton:"left",drawingModes:[BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE]},this.mergeData(e)}return p(t,[{key:"getConfig",value:function(){return this.config}},{key:"mergeData",value:function(t){var e=this;if("object"!=("undefined"==typeof t?"undefined":h(t)))return this.config;this.config=d.extend(this.config,t),this.config.controlButton="right"==t.controlButton?"right":"left";var n=["polylineOptions","polygonOptions","rectangleOptions"];n.map(function(n){n in t&&e._mergeStyle(n,t[n])});var i="enableDrawingTool";i in t&&(this.config[i]=t[i])}},{key:"_mergeStyle",value:function(t,e){var n=this.config[t];this.config[t]=d.extend(n,e)}}]),t}(),B=function(){function t(e){r(this,t),this._map=e,this.drawLayer="",this.listenStore()}return p(t,[{key:"setMouseCursor",value:function(){var t=this._map;t.setDefaultCursor("url('bird.cur')")}},{key:"listenStore",value:function(){var t=this;k.on("ready",function(e,n){"setDrawStatus"===e&&(n?t._open():t._close())})}},{key:"open",value:function(){var t=k.getDrawingType();return 1==t?!0:void _.emit("setDrawStatus",!0)}},{key:"close",value:function(){var t=this,e=k.getDrawingType();return 0==e?!0:(_.emit("setDrawType","normal"),_.emit("setDrawStatus",!1),void setTimeout(function(){t._map.enableDoubleClickZoom()},500))}},{key:"enableCalculate",value:function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()}},{key:"disableCalculate",value:function(){this._enableCalculate=!1}},{key:"_addGeoUtilsLibrary",value:function(){if(!BMapLib.GeoUtils){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"),document.body.appendChild(t)}}},{key:"_addLabel",value:function(t,e){var n=new BMap.Label(e,{position:t});return this._map.addOverlay(n),n}},{key:"setDrawingMode",value:function(t){var e=k.getDrawingType();e!=t&&_.emit("setDrawType",t)}},{key:"getDrawingMode",value:function(){return k.getDrawingType()}},{key:"_open",value:function(){var t=k.getDrawingType();this._setDrawingMode(t)}},{key:"_setDrawingMode",value:function(t){var e=this,n=k.getIsOpen();if(n)switch(e._canvas.__listeners={},t){case BMAP_DRAWING_POLYLINE:case BMAP_DRAWING_POLYGON:e._bindPolylineOrPolygon();break;case BMAP_DRAWING_RECTANGLE:e._bindRectangle()}this._drawingTool&&n&&this._drawingTool.setStyleByDrawingMode(t)}},{key:"_close",value:function(){this._canvas.__listeners={},_.emit("drawingCache",[]),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")}},{key:"_bindPolylineOrPolygon",value:function(){var t=this,e=(this._map,this._canvas),n=[],i=null,o=null,a=!1,r=t.getDrawingMode(),s=this.config.controlButton,l=function(t){("right"!==s||1!=t.button&&0!==t.button)&&(n.push(t.point),i=n.concat(n[n.length-1]),1===n.length?(r===BMAP_DRAWING_POLYLINE?o=new BMap.Polyline(i,{}):r===BMAP_DRAWING_POLYGON&&(o=new BMap.Polygon(i,{})),_.emit("drawingCache",n)):_.emit("drawingCache",n),a||(a=!0,e.enableEdgeMove(),e.addEventListener("mousemove",c),e.addEventListener("dblclick",u)))},c=function(t){_.emit("drawingCache",n.concat(t.point))},u=function g(r){d.stopBubble(r),a=!1,e.disableEdgeMove(),e.removeEventListener("mousedown",l),e.removeEventListener("mousemove",c),e.removeEventListener("dblclick",g),"right"===s?n.push(r.point):d.id<=8||n.pop(),o.setPath(n);var u=t._calculate(o,n);_.emit("drawComplete",{calculate:u,data:[].concat(n)}),t._dispatchOverlayComplete(o,u),n=[],i.length=0,t.close()};e.addEventListener("mousedown",l),e.addEventListener("dblclick",function(t){d.stopBubble(t)})}},{key:"_bindRectangle",value:function(){var t,e=this,n=(e._map,e._canvas),i=null,o=null,a=this.config.controlButton,r=function(i){d.stopBubble(i),d.preventDefault(i),("right"!==a||1!=i.button&&0!=i.button)&&(o=i.point,t=o,_.emit("drawingCache",e._getRectanglePoint(o,t)),n.enableEdgeMove(),n.addEventListener("mousemove",s),d.on(document,"mouseup",l))},s=function(n){t=n.point,_.emit("drawingCache",e._getRectanglePoint(o,t))},l=function c(a){t=a.point||t,i=new BMap.Polygon(e._getRectanglePoint(o,t),{});var r=e._calculate(i,i.getPath()[2]);_.emit("drawComplete",{calculate:r,data:e._getRectanglePoint(o,t)}),e._dispatchOverlayComplete(i,r),n.disableEdgeMove(),o=null,n.removeEventListener("mousemove",s),d.un(document,"mouseup",c)};n.addEventListener("mousedown",r)}},{key:"_calculate",value:function(t,e){var n={data:0,label:null};if(this._enableCalculate&&BMapLib.GeoUtils){var i=t.toString();switch(i){case"[object Polyline]":n.data=BMapLib.GeoUtils.getPolylineDistance(t);break;case"[object Polygon]":n.data=BMapLib.GeoUtils.getPolygonArea(t);break;case"[object Circle]":var o=t.getRadius();n.data=Math.PI*o*o}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(2),n.label=this._addLabel(e,n.data)}return n}},{key:"_getRectanglePoint",value:function(t,e){return[new BMap.Point(t.lng,t.lat),new BMap.Point(e.lng,t.lat),new BMap.Point(e.lng,e.lat),new BMap.Point(t.lng,e.lat),new BMap.Point(t.lng,t.lat)]}},{key:"_dispatchOverlayComplete",value:function(t,e){var n=k.getDrawingType(),i={overlay:t,drawingMode:n};e&&(i.calculate=e.data||null,i.label=e.label||null),this.dispatchEvent(n+"complete",t),this.dispatchEvent("overlaycomplete",i)}}]),t}();B.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,B.prototype.addEventListener=d.lang.Class.prototype.addEventListener,B.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,g.prototype=new BMap.Control,g.prototype.initialize=function(t){var e=this.container=document.createElement("div");e.className="BMapLib_Drawing";var n=this.panel=document.createElement("div");return n.className="BMapLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),e.appendChild(n),n.innerHTML=this._generalHtml(),this._bind(n),t.getContainer().appendChild(e),e},g.prototype._generalHtml=function(t){var e={};e.hander="拖动地图",e[BMAP_DRAWING_MARKER]="画点",e[BMAP_DRAWING_CIRCLE]="画圆",e[BMAP_DRAWING_POLYLINE]="画折线",e[BMAP_DRAWING_POLYGON]="画多边形",e[BMAP_DRAWING_RECTANGLE]="画矩形";var n=function(t,n){return'<a class="'+t+'" drawingType="'+n+'" href="javascript:void(0)" title="'+e[n]+'" onfocus="this.blur()"></a>'},i=[];i.push(n("BMapLib_box BMapLib_hander","hander"));for(var o=0,a=this.drawingModes.length;a>o;o++){var r="BMapLib_box BMapLib_"+this.drawingModes[o];o==a-1&&(r+=" BMapLib_last"),i.push(n(r,this.drawingModes[o]))}return i.join("")},g.prototype._setScale=function(t){var e=390,n=50,i=-parseInt((e-e*t)/2,10),o=-parseInt((n-n*t)/2,10);this.container.style.cssText=["-moz-transform: scale("+t+");","-o-transform: scale("+t+");","-webkit-transform: scale("+t+");","transform: scale("+t+");","margin-left:"+i+"px;","margin-top:"+o+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+t+",","M12=0,","M21=0,","M22="+t+",","SizingMethod='auto expand');"].join("")},g.prototype._bind=function(t){var e=this;d.on(this.panel,"click",function(t){var n=d.getTarget(t),i=n.getAttribute("drawingType");e.setStyleByDrawingMode(i),e._bindEventByDraingMode(i)})},g.prototype.setStyleByDrawingMode=function(t){if(t)for(var e=this.panel.getElementsByTagName("a"),n=0,i=e.length;i>n;n++){var o=e[n];if(o.getAttribute("drawingType")==t){var a="BMapLib_box BMapLib_"+t+"_hover";n==i-1&&(a+=" BMapLib_last"),o.className=a}else o.className=o.className.replace(/_hover/,"")}},g.prototype._bindEventByDraingMode=function(t){var e=this.drawingManager;"hander"==t?(e.close(),e._map.enableDoubleClickZoom()):(e.setDrawingMode(t),e.open(),e._map.disableDoubleClickZoom())};var T=function(){function t(e){r(this,t),this.root=e,this._listenStore()}return p(t,[{key:"_listenStore",value:function(){var t=this;k.listen("ready",function(e,n){var o=arguments;switch(e){case"deletePolygonById":case"setDrawType":t._dispatchEvent.apply(t,i(o))}})}},{key:"_dispatchEvent",value:function(){this.root.dispatchEvent(arguments)}}]),t}(),E=window.BMapLib=E||{},C=function(t){function e(t,n){r(this,e);var i=o(this,Object.getPrototypeOf(e).call(this,t));return l.mixTo(i),i._map=t,i._configObj=new x(n),i.config=i._configObj.getConfig(),i.dispatchEvn=new T(i),i._init(),i}return a(e,t),p(e,[{key:"_init",value:function(){var t=this,e=this.config;t.initDrawingTool(),t.initDrawLayer(),e.enableCalculate===!0?this.enableCalculate():this.disableCalculate()}},{key:"initDrawingTool",value:function(){var t=this.config;if(t.enableDrawingTool){var e=new g(this,t);this._drawingTool=e,this._map.addControl(e)}}},{key:"initDrawLayer",value:function(){this.drawLayer=new D(this._map,this.config),this._canvas=this.drawLayer.canvasLayer}},{key:"deletePolygonById",value:function(t){t&&_.emit("delete_polygon_byid",t)}},{key:"getPolygon",value:function(){var t=k.getBlockData();return t.map(function(t){return{id:t.id,polygons:t.polygons}})}},{key:"unionPolygonById",value:function(){}}]),e}(B);E.ColorBlock=C},{}]},{},[1]);
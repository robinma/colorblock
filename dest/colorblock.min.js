function equals(e,t){var n;for(n in e)if("undefined"==typeof t[n])return!1;for(n in e)if(e[n])switch(typeof e[n]){case"object":if(!equals(e[n],t[n]))return!1;break;case"function":if("undefined"==typeof t[n]||"equals"!=n&&e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}else if(t[n])return!1;for(n in t)if("undefined"==typeof e[n])return!1;return!0}var gpcas=gpcas||{};gpcas.util={},gpcas.geometry={};var Point=function(e,t){this.x=e,this.y=t};gpcas.util.ArrayHelper=function(){};var _static=gpcas.util.ArrayHelper;_static.create2DArray=function(e,t){for(var n=[],i=0;e>i;i++)n[i]=[];return n},_static.valueEqual=function(e,t){return e==t?!0:!!equals(e,t)},_static.sortPointsClockwise=function(e){var t=!1;e instanceof ArrayList&&(e=e.toArray(),t=!0);for(var n,i=null,o=null,r=null,l=null,a=e,p=0;p<e.length;p++){var s=e[p];(null==i||i.y>s.y||i.y==s.y&&s.x<i.x)&&(i=s),(null==o||o.y<s.y||o.y==s.y&&s.x>o.x)&&(o=s),(null==r||r.x>s.x||r.x==s.x&&s.y>r.y)&&(r=s,n=p),(null==l||l.x<s.x||l.x==s.x&&s.y<l.y)&&(l=s)}if(n>0){a=[];for(var u=0,p=n;p<e.length;p++)a[u++]=e[p];for(var p=0;n>p;p++)a[u++]=e[p];e=a}for(var c=!1,p=0;p<e.length;p++){var s=e[p];if(equals(s,o)){c=!0;break}if(equals(s,i))break}if(c){a=[],a[0]=e[0];for(var u=1,p=e.length-1;p>0;p--)a[u++]=e[p];e=a}return t?new ArrayList(e):e};var ArrayHelper=gpcas.util.ArrayHelper;gpcas.util.ArrayList=function(e){this._array=[],null!=e&&(this._array=e)};var p=gpcas.util.ArrayList.prototype;p.add=function(e){this._array.push(e)},p.get=function(e){return this._array[e]},p.size=function(){return this._array.length},p.clear=function(){this._array=[]},p.equals=function(e){if(this._array.length!=e.size())return!1;for(var t=0;t<this._array.length;t++){var n=this._array[t],i=e.get(t);if(!ArrayHelper.valueEqual(n,i))return!1}return!0},p.hashCode=function(){return 0},p.isEmpty=function(){return 0==this._array.length},p.toArray=function(){return this._array},gpcas.geometry.Clip=function(){},gpcas.geometry.Clip.DEBUG=!1,gpcas.geometry.Clip.GPC_EPSILON=2.220446049250313e-16,gpcas.geometry.Clip.GPC_VERSION="2.31",gpcas.geometry.Clip.LEFT=0,gpcas.geometry.Clip.RIGHT=1,gpcas.geometry.Clip.ABOVE=0,gpcas.geometry.Clip.BELOW=1,gpcas.geometry.Clip.CLIP=0,gpcas.geometry.Clip.SUBJ=1;var p=gpcas.geometry.Clip.prototype,_static=gpcas.geometry.Clip;_static.intersection=function(e,t,n){return null!=n&&void 0!=n||(n="PolyDefault"),Clip.clip(OperationType.GPC_INT,e,t,n)},_static.union=function(e,t,n){return null!=n&&void 0!=n||(n="PolyDefault"),Clip.clip(OperationType.GPC_UNION,e,t,n)},_static.xor=function(e,t,n){return null!=n&&void 0!=n||(n="PolyDefault"),Clip.clip(OperationType.GPC_XOR,e,t,n)},_static.difference=function(e,t,n){return null!=n&&void 0!=n||(n="PolyDefault"),Clip.clip(OperationType.GPC_DIFF,t,e,n)},_static.intersection=function(e,t){return Clip.clip(OperationType.GPC_INT,e,t,"PolyDefault.class")},_static.createNewPoly=function(e){return"PolySimple"==e?new PolySimple:"PolyDefault"==e?new PolyDefault:"PolyDefault.class"==e?new PolyDefault:null},_static.clip=function(e,t,n,i){var o=Clip.createNewPoly(i);if(t.isEmpty()&&n.isEmpty()||t.isEmpty()&&(e==OperationType.GPC_INT||e==OperationType.GPC_DIFF)||n.isEmpty()&&e==OperationType.GPC_INT)return o;e!=OperationType.GPC_INT&&e!=OperationType.GPC_DIFF||t.isEmpty()||n.isEmpty()||Clip.minimax_test(t,n,e);var r=new LmtTable,l=new ScanBeamTreeEntries,a=null,p=null;if(t.isEmpty()||(a=Clip.build_lmt(r,l,t,Clip.SUBJ,e)),Clip.DEBUG&&r.print(),n.isEmpty()||(p=Clip.build_lmt(r,l,n,Clip.CLIP,e)),Clip.DEBUG&&r.print(),null==r.top_node)return o;var s=l.build_sbt(),u=[];u[0]=Clip.LEFT,u[1]=Clip.LEFT,e==OperationType.GPC_DIFF&&(u[Clip.CLIP]=Clip.RIGHT),Clip.DEBUG;for(var c=r.top_node,g=new TopPolygonNode,y=new AetTree,d=0;d<s.length;){var f=s[d++],h=0,v=0;if(d<s.length&&(h=s[d],v=h-f),null!=c&&c.y==f){for(var C=c.first_bound;null!=C;C=C.next_bound)Clip.add_edge_to_aet(y,C);c=c.next}Clip.DEBUG&&y.print();var m=-Number.MAX_VALUE,_=y.top_node,P=y.top_node;y.top_node.bundle[Clip.ABOVE][y.top_node.type]=y.top_node.top.y!=f?1:0,y.top_node.bundle[Clip.ABOVE][0==y.top_node.type?1:0]=0,y.top_node.bstate[Clip.ABOVE]=BundleState.UNBUNDLED;for(var x=y.top_node.next;null!=x;x=x.next){var b=x.type,B=0==x.type?1:0;x.bundle[Clip.ABOVE][b]=x.top.y!=f?1:0,x.bundle[Clip.ABOVE][B]=0,x.bstate[Clip.ABOVE]=BundleState.UNBUNDLED,1==x.bundle[Clip.ABOVE][b]&&(Clip.EQ(_.xb,x.xb)&&Clip.EQ(_.dx,x.dx)&&_.top.y!=f&&(x.bundle[Clip.ABOVE][b]^=_.bundle[Clip.ABOVE][b],x.bundle[Clip.ABOVE][B]=_.bundle[Clip.ABOVE][B],x.bstate[Clip.ABOVE]=BundleState.BUNDLE_HEAD,_.bundle[Clip.ABOVE][Clip.CLIP]=0,_.bundle[Clip.ABOVE][Clip.SUBJ]=0,_.bstate[Clip.ABOVE]=BundleState.BUNDLE_TAIL),_=x)}var E=[];E[Clip.CLIP]=HState.NH,E[Clip.SUBJ]=HState.NH;var L=[];L[Clip.CLIP]=0,L[Clip.SUBJ]=0;for(var w=null,C=y.top_node;null!=C;C=C.next){if(L[Clip.CLIP]=C.bundle[Clip.ABOVE][Clip.CLIP]+(C.bundle[Clip.BELOW][Clip.CLIP]<<1),L[Clip.SUBJ]=C.bundle[Clip.ABOVE][Clip.SUBJ]+(C.bundle[Clip.BELOW][Clip.SUBJ]<<1),0!=L[Clip.CLIP]||0!=L[Clip.SUBJ]){C.bside[Clip.CLIP]=u[Clip.CLIP],C.bside[Clip.SUBJ]=u[Clip.SUBJ];var T=!1,S=0,I=0,O=0,D=0;if(e==OperationType.GPC_DIFF||e==OperationType.GPC_INT?(T=0!=L[Clip.CLIP]&&(0!=u[Clip.SUBJ]||0!=E[Clip.SUBJ])||0!=L[Clip.SUBJ]&&(0!=u[Clip.CLIP]||0!=E[Clip.CLIP])||0!=L[Clip.CLIP]&&0!=L[Clip.SUBJ]&&u[Clip.CLIP]==u[Clip.SUBJ],S=0!=u[Clip.CLIP]&&0!=u[Clip.SUBJ]?1:0,I=0!=(u[Clip.CLIP]^C.bundle[Clip.ABOVE][Clip.CLIP])&&0!=(u[Clip.SUBJ]^C.bundle[Clip.ABOVE][Clip.SUBJ])?1:0,O=0!=(u[Clip.CLIP]^(E[Clip.CLIP]!=HState.NH?1:0))&&0!=(u[Clip.SUBJ]^(E[Clip.SUBJ]!=HState.NH?1:0))?1:0,D=0!=(u[Clip.CLIP]^(E[Clip.CLIP]!=HState.NH?1:0)^C.bundle[Clip.BELOW][Clip.CLIP])&&0!=(u[Clip.SUBJ]^(E[Clip.SUBJ]!=HState.NH?1:0)^C.bundle[Clip.BELOW][Clip.SUBJ])?1:0):e==OperationType.GPC_XOR?(T=0!=L[Clip.CLIP]||0!=L[Clip.SUBJ],S=u[Clip.CLIP]^u[Clip.SUBJ],I=u[Clip.CLIP]^C.bundle[Clip.ABOVE][Clip.CLIP]^(u[Clip.SUBJ]^C.bundle[Clip.ABOVE][Clip.SUBJ]),O=u[Clip.CLIP]^(E[Clip.CLIP]!=HState.NH?1:0)^(u[Clip.SUBJ]^(E[Clip.SUBJ]!=HState.NH?1:0)),D=u[Clip.CLIP]^(E[Clip.CLIP]!=HState.NH?1:0)^C.bundle[Clip.BELOW][Clip.CLIP]^(u[Clip.SUBJ]^(E[Clip.SUBJ]!=HState.NH?1:0)^C.bundle[Clip.BELOW][Clip.SUBJ])):e==OperationType.GPC_UNION&&(T=!((0==L[Clip.CLIP]||0!=u[Clip.SUBJ]&&0==E[Clip.SUBJ])&&(0==L[Clip.SUBJ]||0!=u[Clip.CLIP]&&0==E[Clip.CLIP])&&(0==L[Clip.CLIP]||0==L[Clip.SUBJ]||u[Clip.CLIP]!=u[Clip.SUBJ])),S=0!=u[Clip.CLIP]||0!=u[Clip.SUBJ]?1:0,I=0!=(u[Clip.CLIP]^C.bundle[Clip.ABOVE][Clip.CLIP])||0!=(u[Clip.SUBJ]^C.bundle[Clip.ABOVE][Clip.SUBJ])?1:0,O=0!=(u[Clip.CLIP]^(E[Clip.CLIP]!=HState.NH?1:0))||0!=(u[Clip.SUBJ]^(E[Clip.SUBJ]!=HState.NH?1:0))?1:0,D=0!=(u[Clip.CLIP]^(E[Clip.CLIP]!=HState.NH?1:0)^C.bundle[Clip.BELOW][Clip.CLIP])||0!=(u[Clip.SUBJ]^(E[Clip.SUBJ]!=HState.NH?1:0)^C.bundle[Clip.BELOW][Clip.SUBJ])?1:0),u[Clip.CLIP]^=C.bundle[Clip.ABOVE][Clip.CLIP],u[Clip.SUBJ]^=C.bundle[Clip.ABOVE][Clip.SUBJ],0!=L[Clip.CLIP]&&(E[Clip.CLIP]=HState.next_h_state[E[Clip.CLIP]][(L[Clip.CLIP]-1<<1)+u[Clip.CLIP]]),0!=L[Clip.SUBJ]&&(E[Clip.SUBJ]=HState.next_h_state[E[Clip.SUBJ]][(L[Clip.SUBJ]-1<<1)+u[Clip.SUBJ]]),T){var N=C.xb,A=VertexType.getType(O,D,S,I);switch(A){case VertexType.EMN:case VertexType.IMN:C.outp[Clip.ABOVE]=g.add_local_min(N,f),m=N,w=C.outp[Clip.ABOVE];break;case VertexType.ERI:N!=m&&(w.add_right(N,f),m=N),C.outp[Clip.ABOVE]=w,w=null;break;case VertexType.ELI:C.outp[Clip.BELOW].add_left(N,f),m=N,w=C.outp[Clip.BELOW];break;case VertexType.EMX:N!=m&&(w.add_left(N,f),m=N),g.merge_right(w,C.outp[Clip.BELOW]),w=null;break;case VertexType.ILI:N!=m&&(w.add_left(N,f),m=N),C.outp[Clip.ABOVE]=w,w=null;break;case VertexType.IRI:C.outp[Clip.BELOW].add_right(N,f),m=N,w=C.outp[Clip.BELOW],C.outp[Clip.BELOW]=null;break;case VertexType.IMX:N!=m&&(w.add_right(N,f),m=N),g.merge_left(w,C.outp[Clip.BELOW]),w=null,C.outp[Clip.BELOW]=null;break;case VertexType.IMM:N!=m&&(w.add_right(N,f),m=N),g.merge_left(w,C.outp[Clip.BELOW]),C.outp[Clip.BELOW]=null,C.outp[Clip.ABOVE]=g.add_local_min(N,f),w=C.outp[Clip.ABOVE];break;case VertexType.EMM:N!=m&&(w.add_left(N,f),m=N),g.merge_right(w,C.outp[Clip.BELOW]),C.outp[Clip.BELOW]=null,C.outp[Clip.ABOVE]=g.add_local_min(N,f),w=C.outp[Clip.ABOVE];break;case VertexType.LED:C.bot.y==f&&C.outp[Clip.BELOW].add_left(N,f),C.outp[Clip.ABOVE]=C.outp[Clip.BELOW],m=N;break;case VertexType.RED:C.bot.y==f&&C.outp[Clip.BELOW].add_right(N,f),C.outp[Clip.ABOVE]=C.outp[Clip.BELOW],m=N}}}Clip.DEBUG&&g.print(),g.print()}for(var C=y.top_node;null!=C;C=C.next)if(C.top.y==f){var V=C.prev,x=C.next;null!=V?V.next=x:y.top_node=x,null!=x&&(x.prev=V),C.bstate[Clip.BELOW]==BundleState.BUNDLE_HEAD&&null!=V&&V.bstate[Clip.BELOW]==BundleState.BUNDLE_TAIL&&(V.outp[Clip.BELOW]=C.outp[Clip.BELOW],V.bstate[Clip.BELOW]=BundleState.UNBUNDLED,null!=V.prev&&V.prev.bstate[Clip.BELOW]==BundleState.BUNDLE_TAIL&&(V.bstate[Clip.BELOW]=BundleState.BUNDLE_HEAD))}else C.top.y==h?C.xt=C.top.x:C.xt=C.bot.x+C.dx*(h-C.bot.y);if(d<l.sbt_entries){var k=new ItNodeTable;k.build_intersection_table(y,v);for(var M=k.top_node;null!=M;M=M.next){if(_=M.ie[0],P=M.ie[1],!(0==_.bundle[Clip.ABOVE][Clip.CLIP]&&0==_.bundle[Clip.ABOVE][Clip.SUBJ]||0==P.bundle[Clip.ABOVE][Clip.CLIP]&&0==P.bundle[Clip.ABOVE][Clip.SUBJ])){var U=_.outp[Clip.ABOVE],H=P.outp[Clip.ABOVE],R=M.point.x,J=M.point.y+f,X=0!=_.bundle[Clip.ABOVE][Clip.CLIP]&&0==_.bside[Clip.CLIP]||0!=P.bundle[Clip.ABOVE][Clip.CLIP]&&0!=P.bside[Clip.CLIP]||0==_.bundle[Clip.ABOVE][Clip.CLIP]&&0==P.bundle[Clip.ABOVE][Clip.CLIP]&&0!=_.bside[Clip.CLIP]&&0!=P.bside[Clip.CLIP]?1:0,G=0!=_.bundle[Clip.ABOVE][Clip.SUBJ]&&0==_.bside[Clip.SUBJ]||0!=P.bundle[Clip.ABOVE][Clip.SUBJ]&&0!=P.bside[Clip.SUBJ]||0==_.bundle[Clip.ABOVE][Clip.SUBJ]&&0==P.bundle[Clip.ABOVE][Clip.SUBJ]&&0!=_.bside[Clip.SUBJ]&&0!=P.bside[Clip.SUBJ]?1:0,O=0,D=0,S=0,I=0;e==OperationType.GPC_DIFF||e==OperationType.GPC_INT?(O=0!=X&&0!=G?1:0,D=0!=(X^P.bundle[Clip.ABOVE][Clip.CLIP])&&0!=(G^P.bundle[Clip.ABOVE][Clip.SUBJ])?1:0,S=0!=(X^_.bundle[Clip.ABOVE][Clip.CLIP])&&0!=(G^_.bundle[Clip.ABOVE][Clip.SUBJ])?1:0,I=0!=(X^P.bundle[Clip.ABOVE][Clip.CLIP]^_.bundle[Clip.ABOVE][Clip.CLIP])&&0!=(G^P.bundle[Clip.ABOVE][Clip.SUBJ]^_.bundle[Clip.ABOVE][Clip.SUBJ])?1:0):e==OperationType.GPC_XOR?(O=X^G,D=X^P.bundle[Clip.ABOVE][Clip.CLIP]^(G^P.bundle[Clip.ABOVE][Clip.SUBJ]),S=X^_.bundle[Clip.ABOVE][Clip.CLIP]^(G^_.bundle[Clip.ABOVE][Clip.SUBJ]),I=X^P.bundle[Clip.ABOVE][Clip.CLIP]^_.bundle[Clip.ABOVE][Clip.CLIP]^(G^P.bundle[Clip.ABOVE][Clip.SUBJ]^_.bundle[Clip.ABOVE][Clip.SUBJ])):e==OperationType.GPC_UNION&&(O=0!=X||0!=G?1:0,D=0!=(X^P.bundle[Clip.ABOVE][Clip.CLIP])||0!=(G^P.bundle[Clip.ABOVE][Clip.SUBJ])?1:0,S=0!=(X^_.bundle[Clip.ABOVE][Clip.CLIP])||0!=(G^_.bundle[Clip.ABOVE][Clip.SUBJ])?1:0,I=0!=(X^P.bundle[Clip.ABOVE][Clip.CLIP]^_.bundle[Clip.ABOVE][Clip.CLIP])||0!=(G^P.bundle[Clip.ABOVE][Clip.SUBJ]^_.bundle[Clip.ABOVE][Clip.SUBJ])?1:0);var A=VertexType.getType(O,D,S,I);switch(A){case VertexType.EMN:_.outp[Clip.ABOVE]=g.add_local_min(R,J),P.outp[Clip.ABOVE]=_.outp[Clip.ABOVE];break;case VertexType.ERI:null!=U&&(U.add_right(R,J),P.outp[Clip.ABOVE]=U,_.outp[Clip.ABOVE]=null);break;case VertexType.ELI:null!=H&&(H.add_left(R,J),_.outp[Clip.ABOVE]=H,P.outp[Clip.ABOVE]=null);break;case VertexType.EMX:null!=U&&null!=H&&(U.add_left(R,J),g.merge_right(U,H),_.outp[Clip.ABOVE]=null,P.outp[Clip.ABOVE]=null);break;case VertexType.IMN:_.outp[Clip.ABOVE]=g.add_local_min(R,J),P.outp[Clip.ABOVE]=_.outp[Clip.ABOVE];break;case VertexType.ILI:null!=U&&(U.add_left(R,J),P.outp[Clip.ABOVE]=U,_.outp[Clip.ABOVE]=null);break;case VertexType.IRI:null!=H&&(H.add_right(R,J),_.outp[Clip.ABOVE]=H,P.outp[Clip.ABOVE]=null);break;case VertexType.IMX:null!=U&&null!=H&&(U.add_right(R,J),g.merge_left(U,H),_.outp[Clip.ABOVE]=null,P.outp[Clip.ABOVE]=null);break;case VertexType.IMM:null!=U&&null!=H&&(U.add_right(R,J),g.merge_left(U,H),_.outp[Clip.ABOVE]=g.add_local_min(R,J),P.outp[Clip.ABOVE]=_.outp[Clip.ABOVE]);break;case VertexType.EMM:null!=U&&null!=H&&(U.add_left(R,J),g.merge_right(U,H),_.outp[Clip.ABOVE]=g.add_local_min(R,J),P.outp[Clip.ABOVE]=_.outp[Clip.ABOVE])}}0!=_.bundle[Clip.ABOVE][Clip.CLIP]&&(P.bside[Clip.CLIP]=0==P.bside[Clip.CLIP]?1:0),0!=P.bundle[Clip.ABOVE][Clip.CLIP]&&(_.bside[Clip.CLIP]=0==_.bside[Clip.CLIP]?1:0),0!=_.bundle[Clip.ABOVE][Clip.SUBJ]&&(P.bside[Clip.SUBJ]=0==P.bside[Clip.SUBJ]?1:0),0!=P.bundle[Clip.ABOVE][Clip.SUBJ]&&(_.bside[Clip.SUBJ]=0==_.bside[Clip.SUBJ]?1:0);var V=_.prev,x=P.next;if(null!=x&&(x.prev=_),_.bstate[Clip.ABOVE]==BundleState.BUNDLE_HEAD)for(var W=!0;W;)V=V.prev,null!=V?V.bstate[Clip.ABOVE]!=BundleState.BUNDLE_TAIL&&(W=!1):W=!1;null==V?(y.top_node.prev=P,P.next=y.top_node,y.top_node=_.next):(V.next.prev=P,P.next=V.next,V.next=_.next),_.next.prev=V,P.next.prev=P,_.next=x,Clip.DEBUG&&g.print()}for(var C=y.top_node;null!=C;C=C.next){var x=C.next,F=C.succ;if(C.top.y==h&&null!=F){F.outp[Clip.BELOW]=C.outp[Clip.ABOVE],F.bstate[Clip.BELOW]=C.bstate[Clip.ABOVE],F.bundle[Clip.BELOW][Clip.CLIP]=C.bundle[Clip.ABOVE][Clip.CLIP],F.bundle[Clip.BELOW][Clip.SUBJ]=C.bundle[Clip.ABOVE][Clip.SUBJ];var V=C.prev;null!=V?V.next=F:y.top_node=F,null!=x&&(x.prev=F),F.prev=V,F.next=x}else C.outp[Clip.BELOW]=C.outp[Clip.ABOVE],C.bstate[Clip.BELOW]=C.bstate[Clip.ABOVE],C.bundle[Clip.BELOW][Clip.CLIP]=C.bundle[Clip.ABOVE][Clip.CLIP],C.bundle[Clip.BELOW][Clip.SUBJ]=C.bundle[Clip.ABOVE][Clip.SUBJ],C.xb=C.xt;C.outp[Clip.ABOVE]=null}}}return o=g.getResult(i)},_static.EQ=function(e,t){return Math.abs(e-t)<=Clip.GPC_EPSILON},_static.PREV_INDEX=function(e,t){return(e-1+t)%t},_static.NEXT_INDEX=function(e,t){return(e+1)%t},_static.OPTIMAL=function(e,t){return e.getY(Clip.PREV_INDEX(t,e.getNumPoints()))!=e.getY(t)||e.getY(Clip.NEXT_INDEX(t,e.getNumPoints()))!=e.getY(t)},_static.create_contour_bboxes=function(e){for(var t=[],n=0;n<e.getNumInnerPoly();n++){var i=e.getInnerPoly(n);t[n]=i.getBounds()}return t},_static.minimax_test=function(e,t,n){for(var i=Clip.create_contour_bboxes(e),o=Clip.create_contour_bboxes(t),r=e.getNumInnerPoly(),l=t.getNumInnerPoly(),a=ArrayHelper.create2DArray(r,l),p=0;r>p;p++)for(var s=0;l>s;s++)a[p][s]=!(i[p].getMaxX()<o[s].getMinX()||i[p].getMinX()>o[s].getMaxX()||i[p].getMaxY()<o[s].getMinY()||i[p].getMinY()>o[s].getMaxY());for(var s=0;l>s;s++){for(var u=!1,p=0;!u&&r>p;p++)u=a[p][s];u||t.setContributing(s,!1)}if(n==OperationType.GPC_INT)for(var p=0;r>p;p++){for(var u=!1,s=0;!u&&l>s;s++)u=a[p][s];u||e.setContributing(p,!1)}},_static.bound_list=function(e,t){if(null==e.top_node)return e.top_node=new LmtNode(t),e.top_node;for(var n=null,i=e.top_node,o=!1;!o;)if(t<i.y){var r=i;i=new LmtNode(t),i.next=r,null==n?e.top_node=i:n.next=i,o=!0}else t>i.y?null==i.next?(i.next=new LmtNode(t),i=i.next,o=!0):(n=i,i=i.next):o=!0;return i},_static.insert_bound=function(e,t){if(null==e.first_bound)e.first_bound=t;else for(var n=!1,i=null,o=e.first_bound;!n;)t.bot.x<o.bot.x?(null==i?e.first_bound=t:i.next_bound=t,t.next_bound=o,n=!0):t.bot.x==o.bot.x&&t.dx<o.dx?(null==i?e.first_bound=t:i.next_bound=t,t.next_bound=o,n=!0):null==o.next_bound?(o.next_bound=t,n=!0):(i=o,o=o.next_bound)},_static.add_edge_to_aet=function(e,t){if(null==e.top_node)e.top_node=t,t.prev=null,t.next=null;else for(var n=e.top_node,i=null,o=!1;!o;)t.xb<n.xb?(t.prev=i,t.next=n,n.prev=t,null==i?e.top_node=t:i.next=t,o=!0):t.xb==n.xb&&t.dx<n.dx?(t.prev=i,t.next=n,n.prev=t,null==i?e.top_node=t:i.next=t,o=!0):(i=n,null==n.next?(n.next=t,t.prev=n,t.next=null,o=!0):n=n.next)},_static.add_to_sbtree=function(e,t){if(null==e.sb_tree)return e.sb_tree=new ScanBeamTree(t),void e.sbt_entries++;for(var n=e.sb_tree,i=!1;!i;)n.y>t?null==n.less?(n.less=new ScanBeamTree(t),e.sbt_entries++,i=!0):n=n.less:n.y<t?null==n.more?(n.more=new ScanBeamTree(t),e.sbt_entries++,i=!0):n=n.more:i=!0},_static.build_lmt=function(e,t,n,i,o){for(var r=new EdgeTable,l=0;l<n.getNumInnerPoly();l++){var a=n.getInnerPoly(l);if(a.isContributing(0)){var p=0,s=0;r=new EdgeTable;for(var u=0;u<a.getNumPoints();u++)if(Clip.OPTIMAL(a,u)){var c=a.getX(u),g=a.getY(u);r.addNode(c,g),Clip.add_to_sbtree(t,a.getY(u)),p++}for(var y=0;p>y;y++)if(r.FWD_MIN(y)){for(var d=1,f=Clip.NEXT_INDEX(y,p);r.NOT_FMAX(f);)d++,f=Clip.NEXT_INDEX(f,p);var h=y,v=r.getNode(s);v.bstate[Clip.BELOW]=BundleState.UNBUNDLED,v.bundle[Clip.BELOW][Clip.CLIP]=0,v.bundle[Clip.BELOW][Clip.SUBJ]=0;for(var u=0;d>u;u++){var C=r.getNode(s+u),m=r.getNode(h);C.xb=m.vertex.x,C.bot.x=m.vertex.x,C.bot.y=m.vertex.y,h=Clip.NEXT_INDEX(h,p),m=r.getNode(h),C.top.x=m.vertex.x,C.top.y=m.vertex.y,C.dx=(m.vertex.x-C.bot.x)/(C.top.y-C.bot.y),C.type=i,C.outp[Clip.ABOVE]=null,C.outp[Clip.BELOW]=null,C.next=null,C.prev=null,C.succ=d>1&&d-1>u?r.getNode(s+u+1):null,C.pred=d>1&&u>0?r.getNode(s+u-1):null,C.next_bound=null,C.bside[Clip.CLIP]=o==OperationType.GPC_DIFF?Clip.RIGHT:Clip.LEFT,C.bside[Clip.SUBJ]=Clip.LEFT}Clip.insert_bound(Clip.bound_list(e,r.getNode(y).vertex.y),v),Clip.DEBUG&&e.print(),s+=d}for(var y=0;p>y;y++)if(r.REV_MIN(y)){for(var d=1,f=Clip.PREV_INDEX(y,p);r.NOT_RMAX(f);)d++,f=Clip.PREV_INDEX(f,p);var h=y,v=r.getNode(s);v.bstate[Clip.BELOW]=BundleState.UNBUNDLED,v.bundle[Clip.BELOW][Clip.CLIP]=0,v.bundle[Clip.BELOW][Clip.SUBJ]=0;for(var u=0;d>u;u++){var C=r.getNode(s+u),m=r.getNode(h);C.xb=m.vertex.x,C.bot.x=m.vertex.x,C.bot.y=m.vertex.y,h=Clip.PREV_INDEX(h,p),m=r.getNode(h),C.top.x=m.vertex.x,C.top.y=m.vertex.y,C.dx=(m.vertex.x-C.bot.x)/(C.top.y-C.bot.y),C.type=i,C.outp[Clip.ABOVE]=null,C.outp[Clip.BELOW]=null,C.next=null,C.prev=null,C.succ=d>1&&d-1>u?r.getNode(s+u+1):null,C.pred=d>1&&u>0?r.getNode(s+u-1):null,C.next_bound=null,C.bside[Clip.CLIP]=o==OperationType.GPC_DIFF?Clip.RIGHT:Clip.LEFT,C.bside[Clip.SUBJ]=Clip.LEFT}Clip.insert_bound(Clip.bound_list(e,r.getNode(y).vertex.y),v),Clip.DEBUG&&e.print(),s+=d}}else a.setContributing(0,!0)}return r},_static.add_st_edge=function(e,t,n,i){if(null==e)e=new StNode(n,null);else{var o=e.xt-e.xb-(n.xt-n.xb);if(n.xt>=e.xt||n.dx==e.dx||Math.abs(o)<=Clip.GPC_EPSILON){var r=e;e=new StNode(n,r)}else{var l=(n.xb-e.xb)/o,a=e.xb+l*(e.xt-e.xb),p=l*i;t.top_node=Clip.add_intersection(t.top_node,e.edge,n,a,p),e.prev=Clip.add_st_edge(e.prev,t,n,i)}}return e},_static.add_intersection=function(e,t,n,i,o){if(null==e)e=new ItNode(t,n,i,o,null);else if(e.point.y>o){var r=e;e=new ItNode(t,n,i,o,r)}else e.next=Clip.add_intersection(e.next,t,n,i,o);return e},gpcas.geometry.AetTree=function(){this.top_node=null},gpcas.geometry.AetTree.prototype.print=function(){for(var e=this.top_node;null!=e;e=e.next);},gpcas.geometry.BundleState=function(e){this.m_State=e},gpcas.geometry.BundleState.UNBUNDLED=new gpcas.geometry.BundleState("UNBUNDLED"),gpcas.geometry.BundleState.BUNDLE_HEAD=new gpcas.geometry.BundleState("BUNDLE_HEAD"),gpcas.geometry.BundleState.BUNDLE_TAIL=new gpcas.geometry.BundleState("BUNDLE_TAIL"),gpcas.geometry.BundleState.prototype.toString=function(){return this.m_State},gpcas.geometry.EdgeNode=function(){this.vertex=new Point,this.bot=new Point,this.top=new Point,this.xb,this.xt,this.dx,this.type,this.bundle=ArrayHelper.create2DArray(2,2),this.bside=[],this.bstate=[],this.outp=[],this.prev,this.next,this.pred,this.succ,this.next_bound},gpcas.geometry.EdgeTable=function(){this.m_List=new ArrayList},gpcas.geometry.EdgeTable.prototype.addNode=function(e,t){var n=new EdgeNode;n.vertex.x=e,n.vertex.y=t,this.m_List.add(n)},gpcas.geometry.EdgeTable.prototype.getNode=function(e){return this.m_List.get(e)},gpcas.geometry.EdgeTable.prototype.FWD_MIN=function(e){var t=this.m_List,n=t.get(Clip.PREV_INDEX(e,t.size())),i=t.get(Clip.NEXT_INDEX(e,t.size())),o=t.get(e);return n.vertex.y>=o.vertex.y&&i.vertex.y>o.vertex.y},gpcas.geometry.EdgeTable.prototype.NOT_FMAX=function(e){var t=this.m_List,n=t.get(Clip.NEXT_INDEX(e,t.size())),i=t.get(e);return n.vertex.y>i.vertex.y},gpcas.geometry.EdgeTable.prototype.REV_MIN=function(e){var t=this.m_List,n=t.get(Clip.PREV_INDEX(e,t.size())),i=t.get(Clip.NEXT_INDEX(e,t.size())),o=t.get(e);return n.vertex.y>o.vertex.y&&i.vertex.y>=o.vertex.y},gpcas.geometry.EdgeTable.prototype.NOT_RMAX=function(e){var t=this.m_List,n=t.get(Clip.PREV_INDEX(e,t.size())),i=t.get(e);return n.vertex.y>i.vertex.y},gpcas.geometry.HState=function(){},gpcas.geometry.HState.NH=0,gpcas.geometry.HState.BH=1,gpcas.geometry.HState.TH=2;var NH=gpcas.geometry.HState.NH,BH=gpcas.geometry.HState.BH,TH=gpcas.geometry.HState.TH;gpcas.geometry.HState.next_h_state=[[BH,TH,TH,BH,NH,NH],[NH,NH,NH,NH,TH,TH],[NH,NH,NH,NH,BH,BH]],gpcas.geometry.IntersectionPoint=function(e,t,n){this.polygonPoint1=e,this.polygonPoint2=t,this.intersectionPoint=n},gpcas.geometry.IntersectionPoint.prototype.toString=function(){return"P1 :"+polygonPoint1.toString()+" P2:"+polygonPoint2.toString()+" IP:"+intersectionPoint.toString()},gpcas.geometry.ItNode=function(e,t,n,i,o){this.ie=[],this.point=new Point(n,i),this.next=o,this.ie[0]=e,this.ie[1]=t},gpcas.geometry.ItNodeTable=function(){this.top_node},gpcas.geometry.ItNodeTable.prototype.build_intersection_table=function(e,t){for(var n=null,i=e.top_node;null!=i;i=i.next)i.bstate[Clip.ABOVE]!=BundleState.BUNDLE_HEAD&&0==i.bundle[Clip.ABOVE][Clip.CLIP]&&0==i.bundle[Clip.ABOVE][Clip.SUBJ]||(n=Clip.add_st_edge(n,this,i,t))},gpcas.geometry.Line=function(){this.start,this.end},gpcas.geometry.LineHelper=function(){},gpcas.geometry.LineHelper.equalPoint=function(e,t){return e[0]==t[0]&&e[1]==t[1]},gpcas.geometry.LineHelper.equalVertex=function(e,t,n,i){return gpcas.geometry.LineHelper.equalPoint(e,n)&&gpcas.geometry.LineHelper.equalPoint(t,i)||gpcas.geometry.LineHelper.equalPoint(e,i)&&gpcas.geometry.LineHelper.equalPoint(t,n)},gpcas.geometry.LineHelper.distancePoints=function(e,t){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))},gpcas.geometry.LineHelper.clonePoint=function(e){return[e[0],e[1]]},gpcas.geometry.LineHelper.cloneLine=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=[e[n][0],e[n][1]];return t},gpcas.geometry.LineHelper.addLineToLine=function(e,t){for(var n=0;n<t.length;n++)e.push(clonePoint(t[n]))},gpcas.geometry.LineHelper.roundPoint=function(e){e[0]=Math.round(e[0]),e[1]=Math.round(e[1])},gpcas.geometry.LineHelper.lineIntersectLine=function(e,t,n,i,o){null==o&&(o=!0);var r,l,a,p,s,u,c;l=t.y-e.y,p=e.x-t.x,u=t.x*e.y-e.x*t.y,a=i.y-n.y,s=n.x-i.x,c=i.x*n.y-n.x*i.y;var g=l*s-a*p;if(0==g)return null;if(r=new Point,r.x=(p*c-s*u)/g,r.y=(a*u-l*c)/g,o){if(Math.pow(r.x-t.x+(r.y-t.y),2)>Math.pow(e.x-t.x+(e.y-t.y),2))return null;if(Math.pow(r.x-e.x+(r.y-e.y),2)>Math.pow(e.x-t.x+(e.y-t.y),2))return null;if(Math.pow(r.x-i.x+(r.y-i.y),2)>Math.pow(n.x-i.x+(n.y-i.y),2))return null;if(Math.pow(r.x-n.x+(r.y-n.y),2)>Math.pow(n.x-i.x+(n.y-i.y),2))return null}return new Point(Math.round(r.x),Math.round(r.y))},gpcas.geometry.LineIntersection=function(){},gpcas.geometry.LineIntersection.iteratePoints=function(e,t,n,i,o){var r=!0,l=e.length,a=e.indexOf(t),p=e.indexOf(n),s=a;p>a&&(r=!1);var u,c=[];if(r)for(var g=0;l>g&&(u=l>g+s?e[g+s]:e[g+s-l],c.push(u),!equals(u,i)&&!equals(u,o));g++);else for(var g=l;g>=0&&(u=l>g+s?e[g+s]:e[g+s-l],c.push(u),!equals(u,i)&&!equals(u,o));g--);return c},gpcas.geometry.LineIntersection.intersectPoly=function(e,t){for(var n,i,o,r,l,a=e.getNumPoints(),p=null,s=null,u=-1,c=-1,g=!1,y=1;y<t.length;y++){i=t[y-1],o=t[y];for(var d=0,f=Number.MAX_VALUE,h=-1,v=0;a>v;v++)r=e.getPoint(0==v?a-1:v-1),l=e.getPoint(v),null!=(n=LineHelper.lineIntersectLine(i,o,r,l))&&(h=Point.distance(n,o),h>d&&!g&&(d=h,p=new IntersectionPoint(r,l,n),u=y),f>h&&(f=h,s=new IntersectionPoint(r,l,n),c=y-1));g=null!=p}if(null!=p&&null!=s){var C=[];C[0]=p.intersectionPoint;for(var v=1,y=u;c>=y;y++)C[v++]=t[y];if(C[C.length-1]=s.intersectionPoint,equals(p.polygonPoint1,s.polygonPoint1)&&equals(p.polygonPoint2,s.polygonPoint2)||equals(p.polygonPoint1,s.polygonPoint2)&&equals(p.polygonPoint2,s.polygonPoint1)){var m=new PolySimple;m.add(C);var _=e.intersection(m),P=e.xor(m);if(checkPoly(_)&&checkPoly(P))return[_,P]}else{var x=iteratePoints(e.getPoints(),p.polygonPoint1,p.polygonPoint2,s.polygonPoint1,s.polygonPoint2);x=x.concat(C.reverse());var b=iteratePoints(e.getPoints(),p.polygonPoint2,p.polygonPoint1,s.polygonPoint1,s.polygonPoint2);b=b.concat(C);var m=new PolySimple;m.add(x);var B=new PolySimple;B.add(b);var _=e.intersection(m),P=e.intersection(B);if(checkPoly(_)&&checkPoly(P))return[_,P]}}return null},gpcas.geometry.LineIntersection.checkPoly=function(e){for(var t=0,n=0;n<e.getNumInnerPoly();n++){var i=e.getInnerPoly(n);if(i.isHole())return!1;if(t++,t>1)return!1}return!0},gpcas.geometry.LmtNode=function(e){this.y=e,this.first_bound,this.next},gpcas.geometry.LmtTable=function(){this.top_node},gpcas.geometry.LmtTable.prototype.print=function(){for(var e=0,t=this.top_node;null!=t;){for(var n=t.first_bound;null!=n;n=n.next_bound);e++,t=t.next}},gpcas.geometry.OperationType=function(e){this.m_Type=e},gpcas.geometry.OperationType.GPC_DIFF=new gpcas.geometry.OperationType("Difference"),gpcas.geometry.OperationType.GPC_INT=new gpcas.geometry.OperationType("Intersection"),gpcas.geometry.OperationType.GPC_XOR=new gpcas.geometry.OperationType("Exclusive or"),gpcas.geometry.OperationType.GPC_UNION=new gpcas.geometry.OperationType("Union"),gpcas.geometry.PolyDefault=function(e){null==e&&(e=!1),this.m_IsHole=e,this.m_List=new ArrayList},gpcas.geometry.PolyDefault.prototype.equals=function(e){if(!(e instanceof PolyDefault))return!1;var t=e;return this.m_IsHole!=t.m_IsHole?!1:!!equals(this.m_List,t.m_List)},gpcas.geometry.PolyDefault.prototype.hashCode=function(){var e=this.m_List,t=17;return t=37*t+e.hashCode()},gpcas.geometry.PolyDefault.prototype.clear=function(){this.m_List.clear()},gpcas.geometry.PolyDefault.prototype.add=function(e,t){var n=[];if(n[0]=e,t&&(n[1]=t),2==n.length)this.addPointXY(n[0],n[1]);else if(1==n.length)if(n[0]instanceof Point)this.addPoint(n[0]);else if(n[0]instanceof gpcas.geometry.PolySimple)this.addPoly(n[0]);else if(n[0]instanceof Array){var i=n[0];if(2==i.length&&i[0]instanceof Number&&i[1]instanceof Number)this.add(i[0],i[1]);else for(var o=0;o<n[0].length;o++)this.add(n[0][o])}},gpcas.geometry.PolyDefault.prototype.addPointXY=function(e,t){this.addPoint(new Point(e,t))},gpcas.geometry.PolyDefault.prototype.addPoint=function(e){var t=this.m_List;0==t.size()&&t.add(new PolySimple),t.get(0).addPoint(e)},gpcas.geometry.PolyDefault.prototype.addPoly=function(e){var t=this.m_IsHole,n=this.m_List;n.size()>0&&t&&alert("ERROR : Cannot add polys to something designated as a hole."),n.add(e)},gpcas.geometry.PolyDefault.prototype.isEmpty=function(){return this.m_List.isEmpty()},gpcas.geometry.PolyDefault.prototype.getBounds=function(){var e=this.m_List;if(0==e.size())return new Rectangle;if(1==e.size()){var t=this.getInnerPoly(0);return t.getBounds()}console.log("getBounds not supported on complex poly.")},gpcas.geometry.PolyDefault.prototype.getInnerPoly=function(e){return this.m_List.get(e)},gpcas.geometry.PolyDefault.prototype.getNumInnerPoly=function(){var e=this.m_List;return e.size()},gpcas.geometry.PolyDefault.prototype.getNumPoints=function(){return this.m_List.get(0).getNumPoints()},gpcas.geometry.PolyDefault.prototype.getX=function(e){return this.m_List.get(0).getX(e)},gpcas.geometry.PolyDefault.prototype.getPoint=function(e){return this.m_List.get(0).getPoint(e)},gpcas.geometry.PolyDefault.prototype.getPoints=function(){return this.m_List.get(0).getPoints()},gpcas.geometry.PolyDefault.prototype.isPointInside=function(e){var t=this.m_List;if(!t.get(0).isPointInside(e))return!1;for(var n=0;n<t.size();n++){var i=t.get(n);if(i.isHole()&&i.isPointInside(e))return!1}return!0},gpcas.geometry.PolyDefault.prototype.getY=function(e){var t=this.m_List;return t.get(0).getY(e)},gpcas.geometry.PolyDefault.prototype.isHole=function(){var e=this.m_List,t=this.m_IsHole;return e.size()>1&&alert("Cannot call on a poly made up of more than one poly."),t},gpcas.geometry.PolyDefault.prototype.setIsHole=function(e){var t=this.m_List;t.size()>1&&alert("Cannot call on a poly made up of more than one poly."),this.m_IsHole=e},gpcas.geometry.PolyDefault.prototype.isContributing=function(e){var t=this.m_List;return t.get(e).isContributing(0)},gpcas.geometry.PolyDefault.prototype.setContributing=function(e,t){var n=this.m_List;1!=n.size()&&alert("Only applies to polys of size 1"),n.get(e).setContributing(0,t)},gpcas.geometry.PolyDefault.prototype.intersection=function(e){return Clip.intersection(e,this,"PolyDefault")},gpcas.geometry.PolyDefault.prototype.union=function(e){return Clip.union(e,this,"PolyDefault")},gpcas.geometry.PolyDefault.prototype.xor=function(e){return Clip.xor(e,this,"PolyDefault")},gpcas.geometry.PolyDefault.prototype.difference=function(e){return Clip.difference(e,this,"PolyDefault")},gpcas.geometry.PolyDefault.prototype.getArea=function(){for(var e=0,t=0;t<getNumInnerPoly();t++){var n=getInnerPoly(t),i=n.getArea()*(n.isHole()?-1:1);e+=i}return e},gpcas.geometry.PolyDefault.prototype.toString=function(){for(var e="",t=this.m_List,n=0;n<t.size();n++){var i=this.getInnerPoly(n);e+="InnerPoly("+n+").hole="+i.isHole();for(var o=[],r=0;r<i.getNumPoints();r++)o.push(new Point(i.getX(r),i.getY(r)));o=ArrayHelper.sortPointsClockwise(o);for(var l=0;l<o.length;l++)e+=o[l].toString()}return e},gpcas.geometry.Polygon=function(){this.maxTop,this.maxBottom,this.maxLeft,this.maxRight,this.vertices},gpcas.geometry.Polygon.prototype.fromArray=function(e){this.vertices=[];for(var t=0;t<e.length;t++){var n=e[t];this.vertices.push(new Point(n[0],n[1]))}},gpcas.geometry.Polygon.prototype.normalize=function(){for(var e,t=this.vertices,n=this.vertices,i=0;i<t.length;i++){var o=t[i];(null==maxTop||maxTop.y>o.y||maxTop.y==o.y&&o.x<maxTop.x)&&(maxTop=o),(null==maxBottom||maxBottom.y<o.y||maxBottom.y==o.y&&o.x>maxBottom.x)&&(maxBottom=o),(null==maxLeft||maxLeft.x>o.x||maxLeft.x==o.x&&o.y>maxLeft.y)&&(maxLeft=o,e=i),(null==maxRight||maxRight.x<o.x||maxRight.x==o.x&&o.y<maxRight.y)&&(maxRight=o)}if(e>0){n=[];for(var r=0,i=e;i<t.length;i++)n[r++]=this.vertices[i];for(var i=0;e>i;i++)n[r++]=this.vertices[i];t=n}for(var l=!1,a=0;a<this.vertices.length;a++){var o=this.vertices[a];if(equals(o,maxBottom)){l=!0;break}if(equals(o,maxTop))break}if(l){n=[],n[0]=t[0];for(var r=1,i=t.length-1;i>0;i--)n[r++]=this.vertices[i];t=n}},gpcas.geometry.Polygon.prototype.getVertexIndex=function(e){for(var t=0;t<this.vertices.length;t++)if(equals(vertices[t],e))return t;return-1},gpcas.geometry.Polygon.prototype.insertVertex=function(e,t,n){var i=getVertexIndex(e),o=getVertexIndex(t);if(-1==i||-1==o)return!1;if(i>o){var r=i;i=o,o=r}if(o==i+1){for(var l=[],r=0;i>=r;r++)l[r]=this.vertices[r];l[o]=n;for(var r=o;r<this.vertices.length;r++)l[r+1]=this.vertices[r];this.vertices=l}else o==vertices.length-1&&0==i&&this.vertices.push(n);return!0},gpcas.geometry.Polygon.prototype.clone=function(){var e=new Polygon;return e.vertices=vertices.slice(this.vertices.length-1),e},gpcas.geometry.Polygon.prototype.toString=function(){for(var e=this.vertices,t="[",n=0;n<e.length;n++){var i=e[n];t+=(n>0?",":"")+"["+i.x+","+i.y+"]"}return t+="]"},gpcas.geometry.PolygonNode=function(e,t,n){this.active,this.hole,this.v=[],this.next,this.proxy;var i=new VertexNode(t,n);this.v[Clip.LEFT]=i,this.v[Clip.RIGHT]=i,this.next=e,this.proxy=this,this.active=1},gpcas.geometry.PolygonNode.prototype.add_right=function(e,t){var n=new VertexNode(e,t);this.proxy.v[Clip.RIGHT].next=n,this.proxy.v[Clip.RIGHT]=n},gpcas.geometry.PolygonNode.prototype.add_left=function(e,t){var n=this.proxy,i=new VertexNode(e,t);i.next=n.v[Clip.LEFT],n.v[Clip.LEFT]=i},gpcas.geometry.PolySimple=function(){this.m_List=new ArrayList,this.m_Contributes=!0},gpcas.geometry.PolySimple.prototype.equals=function(e){if(!(e instanceof PolySimple))return!1;var t=e,n=this.m_List.size(),i=t.m_List.size();if(n!=i)return!1;if(n>0){for(var o=this.getX(0),r=this.getY(0),l=-1,a=0;-1==l&&i>a;a++){var p=t.getX(a),s=t.getY(a);o==p&&r==s&&(l=a)}if(-1==l)return!1;for(var a=l,u=0;n>u;u++){o=this.getX(u),r=this.getY(u);var p=t.getX(a),s=t.getY(a);if(o!=p||r!=s)return!1;a++,a>=i&&(a=0)}}return!0},gpcas.geometry.PolySimple.prototype.hashCode=function(){
var e=17;return e=37*e+this.m_List.hashCode()},gpcas.geometry.PolySimple.prototype.toString=function(){return"PolySimple: num_points="+getNumPoints()},gpcas.geometry.PolySimple.prototype.clear=function(){this.m_List.clear()},gpcas.geometry.PolySimple.prototype.add=function(e,t){var n=[];if(n[0]=e,t&&(n[1]=t),2==n.length)this.addPointXY(n[0],n[1]);else if(1==n.length)if(n[0]instanceof Point)this.addPoint(n[0]);else if(n[0]instanceof Poly)this.addPoly(n[0]);else if(n[0]instanceof Array)for(var i=0;i<n[0].length;i++){var o=n[0][i];this.add(o)}},gpcas.geometry.PolySimple.prototype.addPointXY=function(e,t){this.addPoint(new Point(e,t))},gpcas.geometry.PolySimple.prototype.addPoint=function(e){this.m_List.add(e)},gpcas.geometry.PolySimple.prototype.addPoly=function(e){alert("Cannot add poly to a simple poly.")},gpcas.geometry.PolySimple.prototype.isEmpty=function(){return this.m_List.isEmpty()},gpcas.geometry.PolySimple.prototype.getBounds=function(){for(var e=Number.MAX_VALUE,t=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=-Number.MAX_VALUE,o=0;o<this.m_List.size();o++){var r=this.getX(o),l=this.getY(o);e>r&&(e=r),r>n&&(n=r),t>l&&(t=l),l>i&&(i=l)}return new Rectangle(e,t,n-e,i-t)},gpcas.geometry.PolySimple.prototype.getInnerPoly=function(e){return 0!=e&&alert("PolySimple only has one poly"),this},gpcas.geometry.PolySimple.prototype.getNumInnerPoly=function(){return 1},gpcas.geometry.PolySimple.prototype.getNumPoints=function(){return this.m_List.size()},gpcas.geometry.PolySimple.prototype.getX=function(e){return this.m_List.get(e).x},gpcas.geometry.PolySimple.prototype.getY=function(e){return this.m_List.get(e).y},gpcas.geometry.PolySimple.prototype.getPoint=function(e){return this.m_List.get(e)},gpcas.geometry.PolySimple.prototype.getPoints=function(){return this.m_List.toArray()},gpcas.geometry.PolySimple.prototype.isPointInside=function(e){for(var t=this.getPoints(),n=t.length-1,i=!1,o=0;o<t.length;o++)(t[o].y<e.y&&t[n].y>=e.y||t[n].y<e.y&&t[o].y>=e.y)&&t[o].x+(e.y-t[o].y)/(t[n].y-t[o].y)*(t[n].x-t[o].x)<e.x&&(i=!i),n=o;return i},gpcas.geometry.PolySimple.prototype.isHole=function(){return!1},gpcas.geometry.PolySimple.prototype.setIsHole=function(e){alert("PolySimple cannot be a hole")},gpcas.geometry.PolySimple.prototype.isContributing=function(e){return 0!=e&&alert("PolySimple only has one poly"),this.m_Contributes},gpcas.geometry.PolySimple.prototype.setContributing=function(e,t){0!=e&&alert("PolySimple only has one poly"),this.m_Contributes=t},gpcas.geometry.PolySimple.prototype.intersection=function(e){return Clip.intersection(this,e,"PolySimple")},gpcas.geometry.PolySimple.prototype.union=function(e){return Clip.union(this,e,"PolySimple")},gpcas.geometry.PolySimple.prototype.xor=function(e){return Clip.xor(e,this,"PolySimple")},gpcas.geometry.PolySimple.prototype.difference=function(e){return Clip.difference(e,this,"PolySimple")},gpcas.geometry.PolySimple.prototype.getArea=function(){if(this.getNumPoints()<3)return 0;for(var e=this.getX(0),t=this.getY(0),n=0,i=1;i<this.getNumPoints()-1;i++){var o=this.getX(i),r=this.getY(i),l=this.getX(i+1),a=this.getY(i+1),p=(l-o)*(t-r)-(e-o)*(a-r);n+=p}return n=.5*Math.abs(n)},gpcas.geometry.Rectangle=function(e,t,n,i){this.x=e,this.y=t,this.w=n,this.h=i},gpcas.geometry.Rectangle.prototype.getMaxY=function(){return this.y+this.h},gpcas.geometry.Rectangle.prototype.getMinY=function(){return this.y},gpcas.geometry.Rectangle.prototype.getMaxX=function(){return this.x+this.w},gpcas.geometry.Rectangle.prototype.getMinX=function(){return this.x},gpcas.geometry.Rectangle.prototype.toString=function(){return"["+x.toString()+" "+y.toString()+" "+w.toString()+" "+h.toString()+"]"},gpcas.geometry.ScanBeamTree=function(e){this.y=e,this.less,this.more},gpcas.geometry.ScanBeamTreeEntries=function(){this.sbt_entries=0,this.sb_tree},gpcas.geometry.ScanBeamTreeEntries.prototype.build_sbt=function(){var e=[],t=0;return t=this.inner_build_sbt(t,e,this.sb_tree),t!=this.sbt_entries,e},gpcas.geometry.ScanBeamTreeEntries.prototype.inner_build_sbt=function(e,t,n){return null!=n.less&&(e=this.inner_build_sbt(e,t,n.less)),t[e]=n.y,e++,null!=n.more&&(e=this.inner_build_sbt(e,t,n.more)),e},gpcas.geometry.StNode=function(e,t){this.edge,this.xb,this.xt,this.dx,this.prev,this.edge=e,this.xb=e.xb,this.xt=e.xt,this.dx=e.dx,this.prev=t},gpcas.geometry.TopPolygonNode=function(){this.top_node},gpcas.geometry.TopPolygonNode.prototype.add_local_min=function(e,t){var n=this.top_node;return this.top_node=new PolygonNode(n,e,t),this.top_node},gpcas.geometry.TopPolygonNode.prototype.merge_left=function(e,t){t.proxy.hole=!0;var n=this.top_node;if(e.proxy!=t.proxy){e.proxy.v[Clip.RIGHT].next=t.proxy.v[Clip.LEFT],t.proxy.v[Clip.LEFT]=e.proxy.v[Clip.LEFT];for(var i=e.proxy,o=n;null!=o;o=o.next)o.proxy==i&&(o.active=0,o.proxy=t.proxy)}},gpcas.geometry.TopPolygonNode.prototype.merge_right=function(e,t){var n=this.top_node;if(t.proxy.hole=!1,e.proxy!=t.proxy){t.proxy.v[Clip.RIGHT].next=e.proxy.v[Clip.LEFT],t.proxy.v[Clip.RIGHT]=e.proxy.v[Clip.RIGHT];for(var i=e.proxy,o=n;null!=o;o=o.next)o.proxy==i&&(o.active=0,o.proxy=t.proxy)}},gpcas.geometry.TopPolygonNode.prototype.count_contours=function(){for(var e=0,t=this.top_node;null!=t;t=t.next)if(0!=t.active){for(var n=0,i=t.proxy.v[Clip.LEFT];null!=i;i=i.next)n++;n>2?(t.active=n,e++):t.active=0}return e},gpcas.geometry.TopPolygonNode.prototype.getResult=function(e){var t=this.top_node,n=Clip.createNewPoly(e),i=this.count_contours();if(i>0){for(var o=0,r=null,l=t;null!=l;l=r)if(r=l.next,0!=l.active){var a=n;i>1&&(a=Clip.createNewPoly(e)),l.proxy.hole&&a.setIsHole(l.proxy.hole);for(var p=l.proxy.v[Clip.LEFT];null!=p;p=p.next)a.add(p.x,p.y);i>1&&n.addPoly(a),o++}var s=n;n=Clip.createNewPoly(e);for(var u=0;u<s.getNumInnerPoly();u++){var c=s.getInnerPoly(u);c.isHole()||n.addPoly(c)}for(var u=0;u<s.getNumInnerPoly();u++){var c=s.getInnerPoly(u);c.isHole()&&n.addPoly(c)}}return n},gpcas.geometry.TopPolygonNode.prototype.print=function(){for(var e=this.top_node,t=0,n=null,i=e;null!=i;i=n)if(n=i.next,0!=i.active){for(var o=i.proxy.v[Clip.LEFT];null!=o;o=o.next);t++}},gpcas.geometry.VertexNode=function(e,t){this.x,this.y,this.next,this.x=e,this.y=t,this.next=null},gpcas.geometry.VertexType=function(){},gpcas.geometry.VertexType.NUL=0,gpcas.geometry.VertexType.EMX=1,gpcas.geometry.VertexType.ELI=2,gpcas.geometry.VertexType.TED=3,gpcas.geometry.VertexType.ERI=4,gpcas.geometry.VertexType.RED=5,gpcas.geometry.VertexType.IMM=6,gpcas.geometry.VertexType.IMN=7,gpcas.geometry.VertexType.EMN=8,gpcas.geometry.VertexType.EMM=9,gpcas.geometry.VertexType.LED=10,gpcas.geometry.VertexType.ILI=11,gpcas.geometry.VertexType.BED=12,gpcas.geometry.VertexType.IRI=13,gpcas.geometry.VertexType.IMX=14,gpcas.geometry.VertexType.FUL=15,gpcas.geometry.VertexType.getType=function(e,t,n,i){return e+(t<<1)+(n<<2)+(i<<3)},gpcas.geometry.WeilerAtherton=function(){},gpcas.geometry.WeilerAtherton.prototype.merge=function(e,t){e=e.clone(),t=t.clone()};var PolyDefault=gpcas.geometry.PolyDefault,ArrayList=gpcas.util.ArrayList,PolySimple=gpcas.geometry.PolySimple,Clip=gpcas.geometry.Clip,OperationType=gpcas.geometry.OperationType,LmtTable=gpcas.geometry.LmtTable,ScanBeamTreeEntries=gpcas.geometry.ScanBeamTreeEntries,EdgeTable=gpcas.geometry.EdgeTable,EdgeNode=gpcas.geometry.EdgeNode,ScanBeamTree=gpcas.geometry.ScanBeamTree,Rectangle=gpcas.geometry.Rectangle,BundleState=gpcas.geometry.BundleState,LmtNode=gpcas.geometry.LmtNode,TopPolygonNode=gpcas.geometry.TopPolygonNode,AetTree=gpcas.geometry.AetTree,HState=gpcas.geometry.HState,VertexType=gpcas.geometry.VertexType,VertexNode=gpcas.geometry.VertexNode,PolygonNode=gpcas.geometry.PolygonNode,ItNodeTable=gpcas.geometry.ItNodeTable,StNode=gpcas.geometry.StNode,ItNode=gpcas.geometry.ItNode;!function e(t,n,i){function o(l,a){if(!n[l]){if(!t[l]){var p="function"==typeof require&&require;if(!a&&p)return p(l,!0);if(r)return r(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[l]={exports:{}};t[l][0].call(u.exports,function(e){var n=t[l][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[l].exports}for(var r="function"==typeof require&&require,l=0;l<i.length;l++)o(i[l]);return o}({1:[function(e,t,n){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){this.options=e||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||0,this._map=e.map,this._lastDrawTime=null,this._enableEdgeMove=!1,this.show()}function p(){}function s(e,t,n){var i=!0;if(e){var o=0,r=e.length,l=t[0],a=t[1],p=t[2];switch(t.length){case 0:for(;r>o;o+=2)i=e[o].call(e[o+1]||n)!==!1&&i;break;case 1:for(;r>o;o+=2)i=e[o].call(e[o+1]||n,l)!==!1&&i;break;case 2:for(;r>o;o+=2)i=e[o].call(e[o+1]||n,l,a)!==!1&&i;break;case 3:for(;r>o;o+=2)i=e[o].call(e[o+1]||n,l,a,p)!==!1&&i;break;default:for(;r>o;o+=2)i=e[o].apply(e[o+1]||n,t)!==!1&&i}}return i}function u(e){return"[object Function]"===Object.prototype.toString.call(e)}function c(e,t){this.drawingManager=e,t=this.drawingToolOptions=t||{},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMap.Size(10,10),this.defaultDrawingModes=[V,M,k],t.drawingModes?this.drawingModes=t.drawingModes:this.drawingModes=this.defaultDrawingModes,t.anchor&&this.setAnchor(t.anchor),t.offset&&this.setOffset(t.offset)}var g=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=d||{guid:"$BAIDU$"};!function(){window[d.guid]={},d.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},d.lang=d.lang||{},d.lang.guid=function(){return"TANGRAM__"+(window[d.guid]._counter++).toString(36)},window[d.guid]._counter=window[d.guid]._counter||1,window[d.guid]._instances=window[d.guid]._instances||{},d.lang.Class=function(e){this.guid=e||d.lang.guid(),window[d.guid]._instances[this.guid]=this},window[d.guid]._instances=window[d.guid]._instances||{},d.lang.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},d.lang.isFunction=function(e){return"[object Function]"==Object.prototype.toString.call(e)},d.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},d.lang.Class.prototype.dispose=function(){delete window[d.guid]._instances[this.guid];for(var e in this)d.lang.isFunction(this[e])||delete this[e];this.disposed=!0},d.lang.Event=function(e,t){this.type=e,this.returnValue=!0,this.target=t||null,this.currentTarget=null},d.lang.Class.prototype.addEventListener=function(e,t,n){if(d.lang.isFunction(t)){!this.__listeners&&(this.__listeners={});var i,o=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;t.hashCode=n,i=n}0!=e.indexOf("on")&&(e="on"+e),"object"!=y(o[e])&&(o[e]={}),i=i||d.lang.guid(),t.hashCode=i,o[e][i]=t}},d.lang.Class.prototype.removeEventListener=function(e,t){if(d.lang.isFunction(t))t=t.hashCode;else if(!d.lang.isString(t))return;!this.__listeners&&(this.__listeners={}),0!=e.indexOf("on")&&(e="on"+e);var n=this.__listeners;n[e]&&n[e][t]&&delete n[e][t]},d.lang.Class.prototype.dispatchEvent=function(e,t){d.lang.isString(e)&&(e=new d.lang.Event(e)),!this.__listeners&&(this.__listeners={}),t=t||{};for(var n in t)e[n]=t[n];var n,i=this.__listeners,o=e.type;if(e.target=e.target||this,e.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),d.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==y(i[o]))for(n in i[o])i[o][n].apply(this,arguments);return e.returnValue},d.lang.inherits=function(e,t,n){var i,o,r=e.prototype,l=new Function;l.prototype=t.prototype,o=e.prototype=new l;for(i in r)o[i]=r[i];e.prototype.constructor=e,e.superClass=t.prototype,"string"==typeof n&&(o._className=n)},d.dom=d.dom||{},d._g=d.dom._g=function(e){return d.lang.isString(e)?document.getElementById(e):e},d.g=d.dom.g=function(e){return"string"==typeof e||e instanceof String?document.getElementById(e):e&&e.nodeName&&(1==e.nodeType||9==e.nodeType)?e:null},d.insertHTML=d.dom.insertHTML=function(e,t,n){e=d.dom.g(e);var i,o;return e.insertAdjacentHTML?e.insertAdjacentHTML(t,n):(i=e.ownerDocument.createRange(),t=t.toUpperCase(),"AFTERBEGIN"==t||"BEFOREEND"==t?(i.selectNodeContents(e),i.collapse("AFTERBEGIN"==t)):(o="BEFOREBEGIN"==t,i[o?"setStartBefore":"setEndAfter"](e),i.collapse(o)),i.insertNode(i.createContextualFragment(n))),e},d.ac=d.dom.addClass=function(e,t){e=d.dom.g(e);for(var n=t.split(/\s+/),i=e.className,o=" "+i+" ",r=0,l=n.length;l>r;r++)o.indexOf(" "+n[r]+" ")<0&&(i+=(i?" ":"")+n[r]);return e.className=i,e},d.event=d.event||{},d.event._listeners=d.event._listeners||[],d.on=d.event.on=function(e,t,n){t=t.replace(/^on/i,""),e=d._g(e);var i,o=function(t){n.call(e,t)},r=d.event._listeners,l=d.event._eventFilter,a=t;return t=t.toLowerCase(),l&&l[t]&&(i=l[t](e,t,o),a=i.type,o=i.listener),e.addEventListener?e.addEventListener(a,o,!1):e.attachEvent&&e.attachEvent("on"+a,o),r[r.length]=[e,t,n,o,a],e},d.un=d.event.un=function(e,t,n){e=d._g(e),t=t.replace(/^on/i,"").toLowerCase();for(var i,o,r,l=d.event._listeners,a=l.length,p=!n;a--;)i=l[a],i[1]!==t||i[0]!==e||!p&&i[2]!==n||(o=i[4],r=i[3],e.removeEventListener?e.removeEventListener(o,r,!1):e.detachEvent&&e.detachEvent("on"+o,r),l.splice(a,1));return e},d.getEvent=d.event.getEvent=function(e){return window.event||e},d.getTarget=d.event.getTarget=function(e){var e=d.getEvent(e);return e.target||e.srcElement},d.preventDefault=d.event.preventDefault=function(e){var e=d.getEvent(e);e.preventDefault?e.preventDefault():e.returnValue=!1},d.stopBubble=d.event.stopBubble=function(e){e=d.getEvent(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},d.browser=d.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(d.browser.ie=d.ie=document.documentMode||+RegExp.$1)}(),a.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,a.prototype.addEventListener=d.lang.Class.prototype.addEventListener,a.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,window.BMap&&(a.prototype=new BMap.Overlay,a.prototype.initialize=function(e){this._map=e;var t=this.canvas=document.createElement("canvas");t.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),e.getPanes()[this.paneName].appendChild(t);var n=this;return e.addEventListener("resize",function(){n.adjustSize(),n._draw()}),this._bind(),this.canvas},a.prototype.adjustSize=function(){var e=this._map.getSize(),t=this.canvas,n=1;n="webgl"==this.context?1:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}(t.getContext("2d")),t.width=e.width*n,t.height=e.height*n,t.style.width=e.width+"px",t.style.height=e.height+"px"},a.prototype.draw=function(){(!this._lastDrawTime||new Date-this._lastDrawTime>10)&&this._draw(),this._lastDrawTime=new Date},a.prototype._draw=function(){var e=this._map,t=e.getSize(),n=e.getCenter();if(n){var i=e.pointToOverlayPixel(n);this.canvas.style.left=i.x-t.width/2+"px",this.canvas.style.top=i.y-t.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},a.prototype.getContainer=function(){return this.canvas},a.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},a.prototype.hide=function(){this.canvas.style.display="none"},a.prototype.setZIndex=function(e){this.canvas.style.zIndex=e},a.prototype.getZIndex=function(){return this.zIndex},a.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},a.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},a.prototype._bind=function(){for(var e=this,t=(this._map,this.getContainer()),n=null,i=null,o=function(e){return{x:e.clientX,y:e.clientY}},r=function(t){var r=t.type;t=d.getEvent(t);var l=e.getDrawPoint(t),a=function(n){t.point=l,e.dispatchEvent(t)};"mousedown"==r&&(n=o(t));var p=o(t);"click"==r?Math.abs(p.x-n.x)<5&&Math.abs(p.y-n.y)<5&&(i&&Math.abs(p.x-i.x)<5&&Math.abs(p.y-i.y)<5?i=null:(a("click"),i=o(t))):a(r)},l=["click","mousedown","mousemove","mouseup","dblclick"],a=l.length;a--;)d.on(t,l[a],r);d.on(t,"mousemove",function(t){e._enableEdgeMove&&e.mousemoveAction(t)})},a.prototype.mousemoveAction=function(e){function t(e){var t=e.clientX,n=e.clientY;return e.changedTouches&&(t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY),new BMap.Pixel(t,n)}var n=this._map,i=this,o=n.pointToPixel(this.getDrawPoint(e)),r=t(e),l=r.x-o.x,a=r.y-o.y;o=new BMap.Pixel(r.x-l,r.y-a),this._draggingMovePixel=o;n.pixelToPoint(o);this._panByX=this._panByY=0,o.x<=20||o.x>=n.width-20||o.y<=50||o.y>=n.height-10?(o.x<=20?this._panByX=8:o.x>=n.width-20&&(this._panByX=-8),o.y<=50?this._panByY=8:o.y>=n.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){n.panBy(i._panByX,i._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},a.prototype.getDrawPoint=function(e){var t=this._map,n=d.getTarget(e),i=e.offsetX||e.layerX||0,o=e.offsetY||e.layerY||0;for(1!=n.nodeType&&(n=n.parentNode);n&&n!=t.getContainer();)0==n.clientWidth&&0==n.clientHeight&&n.offsetParent&&"TD"==n.offsetParent.nodeName||(i+=n.offsetLeft||0,o+=n.offsetTop||0),n=n.offsetParent;var r=new BMap.Pixel(i,o),l=t.pixelToPoint(r);return l});var f=/\s+/;p.prototype.on=function(e,t,n){var i,o,r;if(!t)return this;for(i=this.__events||(this.__events={}),e=e.split(f);o=e.shift();)r=i[o]||(i[o]=[]),r.push(t,n);return this},p.prototype.once=function(e,t,n){var i=this,o=function r(){i.off(e,r),t.apply(n||i,arguments)};return this.on(e,o,n)},p.prototype.off=function(e,t,n){var i,o,r,l;if(!(i=this.__events))return this;if(!(e||t||n))return delete this.__events,this;for(e=e?e.split(f):h(i);o=e.shift();)if(r=i[o])if(t||n)for(l=r.length-2;l>=0;l-=2)t&&r[l]!==t||n&&r[l+1]!==n||r.splice(l,2);else delete i[o];return this},p.prototype.trigger=function(e){var t,n,i,o,r,l,a=[],p=!0;if(!(t=this.__events))return this;for(e=e.split(f),r=1,l=arguments.length;l>r;r++)a[r-1]=arguments[r];for(;n=e.shift();)(i=t.all)&&(i=i.slice()),(o=t[n])&&(o=o.slice()),"all"!==n&&(p=s(o,a,this)&&p),p=s(i,[n].concat(a),this)&&p;return p},p.prototype.emit=p.prototype.trigger;var h=Object.keys;h||(h=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),p.mixTo=function(e){function t(t){e[t]=function(){return n[t].apply(o,Array.prototype.slice.call(arguments)),this}}var n=p.prototype;if(u(e)){for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i]);Object.keys(n).forEach(function(t){e.prototype[t]=n[t]})}else{var o=new p;for(var i in n)n.hasOwnProperty(i)&&t(i)}};var v=function(){function e(){l(this,e),this.emits={},this.maxId=0}return g(e,[{key:"on",value:function(e,t){this.emits[e]=this.emits[e]||{};var n=++this.maxId;return this.emits[e][n]=t,n}},{key:"listen",value:function(){this.on.apply(this,arguments)}},{key:"unbind",value:function(e){for(var t in this.emits){var n=this.emits[t];for(var i in n)if(e==e)return delete this.emits[t][e],!0}return!1}},{key:"emit",value:function(e,t){var n=Array.prototype.slice.call(arguments,1);for(var i in this.emits[e]){var o;(o=this.emits[e])[i].apply(o,r(n))}}},{key:"trigger",value:function(){this.emit.apply(this,arguments)}}]),e}(),C=function(e){function t(){return l(this,t),i(this,Object.getPrototypeOf(t).call(this))}return o(t,e),g(t,[{key:"bindEvent",value:function(e){this.event=e}}]),t}(v),m=new v,_=gpcas.geometry.PolyDefault,P=function(){function e(t,n){l(this,e),this.blockDatas=[].concat(t),this.currPolygon=[].concat(n),this.interPoints=[],this.defPolygon=[],this._initDefPolygon(t,n)}return g(e,[{key:"getPolygon",value:function(){return this.defPolygon}},{key:"_initDefPolygon",value:function(e,t){return e.length&&t.length?void this._diffAllPolygon(e,t):e.length?void this.defPolygon.push(e):void(t.length&&this.defPolygon.push(t))}},{key:"_diffAllPolygon",value:function(e,t){var n=this,i=[t],o=void 0,r=void 0;e.map(function(e,t){e.polygons.map(function(e,t){var l=[];i.map(function(t,i){o=n._createPoly(n._getTempPolygon(e)),r=n._createPoly(n._getTempPolygon(t));var a=n._diffPolygon(o,r);l=l.concat(a)}),i=l})}),n.defPolygon=n.defPolygon.concat(i)}},{key:"_diffPolygon",value:function(e,t){var n=t.difference(e),i=this._getPolygons(n);return i}},{key:"_getPolygons",value:function(e){for(var t=this,n=e.getNumInnerPoly(),i=[],o=0;n>o;o++){var r=e.getInnerPoly(o),l=t._getPolygonVertices(r),a=l.map(function(e,t){return{lat:e[0]/1e6,lng:e[1]/1e6}});a.push(a[0]),i.push(a)}return i}},{key:"_getTempPolygon",value:function(e){var t=[];return e.map(function(e,n){t.push(Object.assign(e,{x:1e6*e.lat,y:1e6*e.lng}))}),t}},{key:"_createPoly",value:function(e){var t=new _;return e.map(function(e,n){t.addPoint(new x(e.x,e.y))}),t}},{key:"_getPolygonVertices",value:function(e){var t,n=[],i=e.getNumPoints();for(t=0;i>t;t++)n.push([e.getX(t),e.getY(t)]);return n}}]),e}(),x=function J(e,t){l(this,J),this.x=e,this.y=t},b="polygon",B=function(e){function t(){l(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.data={drawingType:"normal",_isopen:!1,cacheData:[],blockData:[],unionPolygon:[],interPoints:[]},e.bindEvent(m),e.onReady(),e}return o(t,e),g(t,[{key:"setDrawingType",value:function(e){this.data.drawingType=e}},{key:"getDrawingType",value:function(){return this.data.drawingType}},{key:"setIsOpen",value:function(e){this.data._isopen=e}},{key:"getIsOpen",value:function(){return this.data._isopen}},{key:"setCacheData",value:function(e){this.data.cacheData=this._formateData(e)}},{key:"getCacheData",value:function(){return this.data.cacheData}},{key:"getUniqId",value:function(e){return(e||"")+(new Date).getTime().toString(36)}},{key:"deletePolygonById",value:function(e){var t=this.getBlockData(),n=!1,i=t.filter(function(t){return t.id===e?(hadremove=!0,!1):!0},this);return this.data.blockData=i,n}},{key:"setBlockData",value:function(e){e.data=this._formateData(e.data);var t=this._getPolygonData(e),n={};n.drawingType=this.getDrawingType(),n.id=this.getUniqId("block"),n.polygons=t,d.extend(n,e),this.data.blockData.push(n)}},{key:"getBlockData",value:function(){return this.data.blockData}},{key:"_formateData",value:function(e){var t=this.getDrawingType();return t===b&&e.length>0&&(e=e.concat(e[0])),e}},{key:"setLastPolygon",value:function(e){this.data.lastPolygon=e}},{key:"getLastPolygon",value:function(){return this.data.lastPolygon}},{key:"setInterPoints",value:function(e){this.data.interPoints=this.data.interPoints.concat(e)}},{key:"getInterPoints",value:function(){return this.data.interPoints}},{key:"_getPolygonData",value:function(e){var t=this.getBlockData(),n=new P(t,e.data),i=n.getPolygon();return i}},{key:"onReady",value:function(){var e=this,t="ready";this.event.on("setDrawType",function(n){e.setDrawingType(n),e.trigger(t,"setDrawType",e.getDrawingType())}),this.event.on("setDrawStatus",function(n){e.setIsOpen(n),e.trigger(t,"setDrawStatus",e.getIsOpen())}),this.event.on("drawingCache",function(n){e.setCacheData(n),e.trigger(t,"drawingCache",e.getCacheData())}),this.event.on("drawComplete",function(n){e.setBlockData(n),e.setCacheData([]),e.trigger(t,"drawComplete",e.getBlockData())}),this.event.on("delete_polygon_byid",function(n){var i=e.deletePolygonById(n);e.trigger(t,"deletePolygonById",i,e.getBlockData())})}}]),t}(C),E=new B,L=function(){function e(t,n){l(this,e);var i=this;i.map=t,i.config=n,i.canvasLayer=new a({map:t,update:function(){i._updateMap.apply(i)}});var o=i.ctx=i.canvasLayer.canvas.getContext("2d");o&&(p.mixTo(i),i._listenStore())}return g(e,[{key:"_listenStore",value:function(){var e=this;E.listen("ready",function(t,n){"drawingCache"===t?e._updateMap():"drawComplete"===t&&e._updateMap()})}},{key:"_updateMap",value:function(){this.canvasLayer&&this._drawCtx()}},{key:"_drawCtx",value:function(){this._clearRect(),this._drawCacheData(),this._drawPolygonData(),this._drawInterPoints()}},{key:"_clearRect",value:function(){var e=this.ctx;e.clearRect(0,0,e.canvas.width,e.canvas.height)}},{key:"_drawCacheData",value:function(){var e=this,t=E.getCacheData(),n=E.getBlockData(),i=E.getDrawingType(),o=void 0;0!=t.length&&t&&(o=t.map(function(t,n){return e._lnglatToPix(t)}),this._drawDispatcher(i,o,n.length))}},{key:"_drawBlockData",value:function(){var e=this,t=E.getBlockData();0!==t.length&&t&&t.map(function(t,n){var i=t.data.map(function(t,n){return e._lnglatToPix(t)});e._drawDispatcher(t.drawingType,i)})}},{key:"_drawPolygonData",value:function(){var e=this,t=E.getBlockData();0!==t.length&&t&&t.map(function(t,n){t.polygons.map(function(i){var o=i.map(function(t){return e._lnglatToPix(t)});e._drawDispatcher(t.drawingType,o,n)})})}},{key:"_drawInterPoints",value:function(){var e=this,t=E.getInterPoints();if(0!==t.length){var n=t.map(function(t){return e._lnglatToPix(t)});e._drawArcPoints(n)}}},{key:"_lnglatToPix",value:function(e){var t=this.map,n=t.pointToPixel(e);return n}},{key:"_drawDispatcher",value:function(e,t,n){var i=this;switch(e){case"rectangle":i.drawPolygon(t,i._drawStyle(n));break;case"polygon":i.drawPolygon(t,i._drawStyle(n))}}},{key:"_drawStyle",value:function(e){var t=this,n=t.config.polygonOptions,i=n.fillColor,o=n.strokeColor,r=n.strokeWeight;return{fillColor:"string"==typeof i?i:i[e%i.length],strokeColor:"string"==typeof o?o:o[e%o.length],strokeWeight:r}}},{key:"drawRectangle",value:function(e,t){var n=this,i=(n.map,n.ctx),o=e[0],r=e[2],l=r.x-o.x,a=r.y-o.y;i.beginPath(),n.setPixelRatio(function(){i.rect(o.x,o.y,l,a),i.fillStyle=t.fillColor,i.fill(),i.strokeStyle=t.strokeColor,i.lineWidth=t.strokeWeight,i.stroke(),i.closePath()})}},{key:"drawPolygon",value:function(e,t){var n=(arguments.length<=2||void 0===arguments[2]?!0:arguments[2],this),i=(this.map,n.ctx);i.beginPath(),n.setPixelRatio(function(){e.map(function(e,t){0===t?i.moveTo(e.x,e.y):i.lineTo(e.x,e.y)}),i.fillStyle=t.fillColor,i.fill(),i.strokeStyle=t.strokeColor,i.lineWidth=t.strokeWeight,i.stroke(),i.closePath()})}},{key:"drawPolyline",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];this.drawPolygon(e,t,n)}},{key:"getPixelRatio",value:function(){var e=this.ctx,t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}},{key:"setPixelRatio",value:function(e){var t=this.ctx,n=this.getPixelRatio();t.save(),t.scale(n,n),e&&e(),t.restore()}},{key:"_drawArcPoints",value:function(e){this._storkArc(e),this._fillArc(e)}},{key:"_storkArc",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?3:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"#ffff00":arguments[2],i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],o=this.ctx;o.strokeStyle=n,o.lineWidth=i,this.setPixelRatio(function(){e.map(function(e){o.beginPath(),o.arc(e.x,e.y,t,0,2*Math.PI),o.closePath(),o.stroke()})})}},{key:"_fillArc",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?3:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"#ffffff":arguments[2],i=this.ctx;i.fillStyle=n,this.setPixelRatio(function(){e.map(function(e){i.beginPath(),i.arc(e.x,e.y,t,0,2*Math.PI),i.closePath(),i.fill()})})}}]),e}(),w={strokeColor:"red",fillColor:"rgba(255,0,0,0.5)",strokeWeight:3},T="rectangle",S="polygon",I=function(){function e(t){l(this,e),this.config={anchor:BMAP_ANCHOR_TOP_RIGHT,offset:new BMap.Size(5,5),polygonOptions:w,polylineOptions:w,rectangleOptions:w,enableDrawingTool:!0,enableCalculate:!1,controlButton:"left",drawingModes:[S,T]},this.mergeData(t)}return g(e,[{key:"getConfig",value:function(){return this.config}},{key:"mergeData",value:function(e){var t=this;if("object"!=("undefined"==typeof e?"undefined":y(e)))return this.config;this.config=d.extend(this.config,e),this.config.controlButton="right"==e.controlButton?"right":"left";var n=["polylineOptions","polygonOptions","rectangleOptions"];n.map(function(n){n in e&&t._mergeStyle(n,e[n])});var i="enableDrawingTool";i in e&&(this.config[i]=e[i])}},{key:"_mergeStyle",value:function(e,t){var n=this.config[e];this.config[e]=d.extend(n,t)}}]),e}(),O="polyline",D="rectangle",N="polygon",A=function(){function e(t){l(this,e),this._map=t,this.drawLayer="",this.listenStore()}return g(e,[{key:"setMouseCursor",value:function(){var e=this._map;e.setDefaultCursor("url('bird.cur')")}},{key:"listenStore",value:function(){var e=this;E.on("ready",function(t,n){"setDrawStatus"===t&&(n?e._open():e._close())})}},{key:"open",value:function(){var e=E.getDrawingType();return 1==e?!0:void m.emit("setDrawStatus",!0)}},{key:"close",value:function(){var e=this,t=E.getDrawingType();return 0==t?!0:(m.emit("setDrawType","normal"),m.emit("setDrawStatus",!1),void setTimeout(function(){e._map.enableDoubleClickZoom()},500))}},{key:"enableCalculate",value:function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()}},{key:"disableCalculate",value:function(){this._enableCalculate=!1}},{key:"_addGeoUtilsLibrary",value:function(){if(!BMapLib.GeoUtils){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"),document.body.appendChild(e)}}},{key:"_addLabel",value:function(e,t){var n=new BMap.Label(t,{position:e});return this._map.addOverlay(n),n}},{key:"setDrawingMode",value:function(e){var t=E.getDrawingType();t!==e&&m.emit("setDrawType",e)}},{key:"getDrawingMode",value:function(){return E.getDrawingType()}},{key:"_open",value:function(){var e=E.getDrawingType();this._setDrawingMode(e)}},{key:"_setDrawingMode",value:function(e){var t=this,n=E.getIsOpen();if(n)switch(t._canvas.__listeners={},e){case O:case N:t._bindPolylineOrPolygon();break;case D:t._bindRectangle()}this._drawingTool&&n&&this._drawingTool.setStyleByDrawingMode(e)}},{key:"_close",value:function(){this._canvas.__listeners={},m.emit("drawingCache",[]),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")}},{key:"_bindPolylineOrPolygon",value:function(){var e=this,t=(this._map,this._canvas),n=[],i=null,o=null,r=!1,l=e.getDrawingMode(),a=this.config.controlButton,p=function(e){("right"!==a||1!=e.button&&0!==e.button)&&(n.push(e.point),i=n.concat(n[n.length-1]),1===n.length?(l===O?o=new BMap.Polyline(i,{}):l===N&&(o=new BMap.Polygon(i,{})),m.emit("drawingCache",n)):m.emit("drawingCache",n),r||(r=!0,t.enableEdgeMove(),t.addEventListener("mousemove",s),t.addEventListener("dblclick",u)))},s=function(e){m.emit("drawingCache",n.concat(e.point))},u=function c(l){d.stopBubble(l),r=!1,t.disableEdgeMove(),t.removeEventListener("mousedown",p),t.removeEventListener("mousemove",s),t.removeEventListener("dblclick",c),"right"===a?n.push(l.point):d.id<=8||n.pop(),o.setPath(n);var u=e._calculate(o,n);m.emit("drawComplete",{calculate:u,data:[].concat(n)}),e._dispatchOverlayComplete(o,u),n=[],i.length=0,e.close()};t.addEventListener("mousedown",p),
t.addEventListener("dblclick",function(e){d.stopBubble(e)})}},{key:"_bindRectangle",value:function(){var e,t=this,n=(t._map,t._canvas),i=null,o=null,r=this.config.controlButton,l=function(i){d.stopBubble(i),d.preventDefault(i),("right"!==r||1!=i.button&&0!=i.button)&&(o=i.point,e=o,m.emit("drawingCache",t._getRectanglePoint(o,e)),n.enableEdgeMove(),n.addEventListener("mousemove",a),d.on(document,"mouseup",p))},a=function(n){e=n.point,m.emit("drawingCache",t._getRectanglePoint(o,e))},p=function s(r){e=r.point||e,i=new BMap.Polygon(t._getRectanglePoint(o,e),{});var l=t._calculate(i,i.getPath()[2]);m.emit("drawComplete",{calculate:l,data:t._getRectanglePoint(o,e)}),t._dispatchOverlayComplete(i,l),n.disableEdgeMove(),o=null,n.removeEventListener("mousemove",a),d.un(document,"mouseup",s)};n.addEventListener("mousedown",l)}},{key:"_calculate",value:function(e,t){var n={data:0,label:null};if(this._enableCalculate&&BMapLib.GeoUtils){var i=e.toString();switch(i){case"[object Polyline]":n.data=BMapLib.GeoUtils.getPolylineDistance(e);break;case"[object Polygon]":n.data=BMapLib.GeoUtils.getPolygonArea(e);break;case"[object Circle]":var o=e.getRadius();n.data=Math.PI*o*o}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(2),n.label=this._addLabel(t,n.data)}return n}},{key:"_getRectanglePoint",value:function(e,t){return[new BMap.Point(e.lng,e.lat),new BMap.Point(t.lng,e.lat),new BMap.Point(t.lng,t.lat),new BMap.Point(e.lng,t.lat),new BMap.Point(e.lng,e.lat)]}},{key:"_dispatchOverlayComplete",value:function(e,t){var n=E.getDrawingType(),i={overlay:e,drawingMode:n};t&&(i.calculate=t.data||null,i.label=t.label||null),this.dispatchEvent(n+"complete",e),this.dispatchEvent("overlaycomplete",i)}}]),e}();A.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,A.prototype.addEventListener=d.lang.Class.prototype.addEventListener,A.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener;var V="polyline",k="rectangle",M="polygon";c.prototype=new BMap.Control,c.prototype.initialize=function(e){var t=this.container=document.createElement("div");t.className="BMapLib_Drawing";var n=this.panel=document.createElement("div");return n.className="BMapLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),t.appendChild(n),n.innerHTML=this._generalHtml(),this._bind(n),e.getContainer().appendChild(t),t},c.prototype._generalHtml=function(e){var t={};t.hander="拖动地图",t[V]="画折线",t[M]="画多边形",t[k]="画矩形";var n=function(e,n){return'<a class="'+e+'" drawingType="'+n+'" href="javascript:void(0)" title="'+t[n]+'" onfocus="this.blur()"></a>'},i=[];i.push(n("BMapLib_box BMapLib_hander","hander"));for(var o=0,r=this.drawingModes.length;r>o;o++){var l="BMapLib_box BMapLib_"+this.drawingModes[o];o==r-1&&(l+=" BMapLib_last"),i.push(n(l,this.drawingModes[o]))}return i.join("")},c.prototype._setScale=function(e){var t=390,n=50,i=-parseInt((t-t*e)/2,10),o=-parseInt((n-n*e)/2,10);this.container.style.cssText=["-moz-transform: scale("+e+");","-o-transform: scale("+e+");","-webkit-transform: scale("+e+");","transform: scale("+e+");","margin-left:"+i+"px;","margin-top:"+o+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+e+",","M12=0,","M21=0,","M22="+e+",","SizingMethod='auto expand');"].join("")},c.prototype._bind=function(e){var t=this;d.on(this.panel,"click",function(e){var n=d.getTarget(e),i=n.getAttribute("drawingType");t.setStyleByDrawingMode(i),t._bindEventByDraingMode(i)})},c.prototype.setStyleByDrawingMode=function(e){if(e)for(var t=this.panel.getElementsByTagName("a"),n=0,i=t.length;i>n;n++){var o=t[n];if(o.getAttribute("drawingType")==e){var r="BMapLib_box BMapLib_"+e+"_hover";n==i-1&&(r+=" BMapLib_last"),o.className=r}else o.className=o.className.replace(/_hover/,"")}},c.prototype._bindEventByDraingMode=function(e){var t=this.drawingManager;"hander"==e?(t.close(),t._map.enableDoubleClickZoom()):(t.setDrawingMode(e),t.open(),t._map.disableDoubleClickZoom())};var U=function(){function e(t){l(this,e),this.root=t,this._listenStore()}return g(e,[{key:"_listenStore",value:function(){var e=this;E.listen("ready",function(t,n){var i,o=arguments;switch(t){case"deletePolygonById":case"setDrawType":(i=e.root).dispatchEvent.apply(i,r(o))}})}}]),e}(),H=window.BMapLib=H||{},R=function(e){function t(e,n){l(this,t);var o=i(this,Object.getPrototypeOf(t).call(this,e));return p.mixTo(o),o._map=e,o._configObj=new I(n),o.config=o._configObj.getConfig(),o.dispatchEvn=new U(o),o._init(),o}return o(t,e),g(t,[{key:"_init",value:function(){var e=this,t=this.config;e.initDrawingTool(),e.initDrawLayer(),t.enableCalculate===!0?this.enableCalculate():this.disableCalculate()}},{key:"initDrawingTool",value:function(){var e=this.config;if(e.enableDrawingTool){var t=new c(this,e);this._drawingTool=t,this._map.addControl(t)}}},{key:"initDrawLayer",value:function(){this.drawLayer=new L(this._map,this.config),this._canvas=this.drawLayer.canvasLayer}},{key:"deletePolygonById",value:function(e){e&&m.emit("delete_polygon_byid",e)}},{key:"getPolygon",value:function(){var e=E.getBlockData();return e.map(function(e){return{id:e.id,polygons:e.polygons}})}},{key:"unionPolygonById",value:function(){}}]),t}(A);H.ColorBlock=R},{}]},{},[1]);